import e,{div as a,label as t,strong as r,input as s,nav as c,button as o}from"/Utils/elements.js";import{useCallback as l,useState as i,useEffect as m,useRef as n,useContext as d}from"/cdn/react";import{Globals as u}from"/Views/index.js";import f from"/Utils/use-lang.js";import p from"/Utils/load-css.js";import g from"/Utils/use-toggle.js";import b from"/Components/list-limit.js";import{getRitoCardsFromDataDump as N}from"/Components/deck/hooks/use-filterable-rito-card-list.js";import x from"/Utils/use-asset-cache.js";import{getRitoCards as k,patchRitoCards as v,getLatestRitoData as y,getCardList as C,getCard as w,saveCard as h,deleteCard as j}from"/Utils/service.js";import A from"/Components/deck/card-name.js";import U from"/cdn/object-hash";const _=p("/Components/card-config/edit-associated-cards.css");export default e((function(e){const s=f(),p=d(u),w=!0===p.state.settings.lowSpecsMode,[h,j]=g(!1),[_,S]=i("custom"),V=n({}),[z,E]=i();m((()=>{k().then((e=>{let a;E(a=N(e)),Array.prototype.forEach.call(a||[],(e=>{e&&(V.current[e.cardCode]=e)}))}))}),[]);const[L,$]=i(!1),M=l((()=>{L||($(!0),y({},p.state.settings.lang).then((async e=>{await v(e),E(N(e)),$(!1)})))}),[L]),[q,B]=i([]),[D,F]=i("");m((()=>{if(!Array.isArray(z))return;const e=z.filter((e=>e&&e.name.toLowerCase().includes(D)));B(e)}),[D,z]);const G=x((e=>{C({exclude:["deck"]}).then((a=>{e(a),Array.prototype.forEach.call(a,(e=>{V.current[e.id]=e}))}))}),[]),[H,I]=i([]),[J,K]=i("");m((()=>{if(!Array.isArray(G))return;const e=G.filter((e=>e&&e.name&&e.name.toLowerCase().includes(D)));I(e)}),[J,G]);const O=l((a=>{const t={id:a.id,cardCode:a.cardCode,artUrl:a.url},r=U(t);t.key=r;let s=e.value||[];Array.isArray(s)||(s=[]);if(s.some((e=>e.key===r)))return;const c=[t,...s];e.updateValue(c)}),[e.value,e.updateValue]),P=x((a=>{a((e.value||[]).map((e=>V.current[e.id]||V.current[e.cardCode]||e)))}),[e.value,G,z],[]);return a({className:"associated-cards"},t({onClick:j,className:"flex clickable"},a({className:"grow flex vcenter"},r(e.label)),o({className:"gutter-trbl-.5 flex vcenter"},a({className:`icon ${w?"":"animated"} ${h?"multiply":"chevron-down"}`}))),a({className:"gutter-b-2 accordian "+(h?"expanded":"")},c({className:"flex no-wrap tabs gutter-t-.5"},a({className:("custom"===_?"active ":"")+"tab-header grow gutter-trbl-.5 clickable flex vhcenter text-center",onClick:()=>S("custom")},s("custom_cards")),a({className:("rito"===_?"active ":"")+"tab-header grow gutter-trbl-.5 clickable flex vhcenter text-center",onClick:()=>S("rito")},s("official_cards")),a({className:("associated"===_?"active ":"")+"tab-header grow gutter-trbl-.5 clickable flex vhcenter text-center",onClick:()=>S("associated")},e.label)),a({className:"tab-body gutter-t"},"custom"===_?a({className:"gutter-rl"},a(b({defaultSize:w?8:24},(H||[]).map((e=>e?a({className:"flex gutter-b",key:e.id},A({card:e,className:"box-9"},e.name),a({className:"box-3 flex no-wrap"},o({className:"grow gutter-trbl-.5",onClick:()=>O(e)},a({className:"icon link"})))):void 0))))):void 0,"rito"===_?a({className:"gutter-rl"},a(b({defaultSize:w?8:24},(q||[]).map((e=>e?a({className:"flex gutter-b",key:e.cardCode},A({card:e,className:"box-9"},e.name),a({className:"box-3 flex no-wrap"},o({className:"grow gutter-trbl-.5",onClick:()=>O(e)},a({className:"icon link"})))):void 0))),z&&z.length?void 0:a({className:"flex"},o({onClick:M,className:"gutter-trbl-.5 grow"},L?a({className:"icon loading"}):s("load_rito_data"))))):void 0,"associated"===_?a({className:"gutter-rl"},(P||[]).map((e=>e?a({className:"flex gutter-b",key:e.id||e.cardCode||e.url},A({card:e,className:"box-9"},e.name),a({className:"box-3 flex no-wrap"},o({className:"grow gutter-trbl-.5"},a({className:"icon multiply"})))):void 0))):void 0)))}),_);