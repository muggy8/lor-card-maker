import e,{div as a,label as t,strong as r,input as s,nav as c,button as o}from"/Utils/elements.js";import{useCallback as l,useState as i,useEffect as m,useRef as n,useContext as d}from"/cdn/react";import{Globals as u}from"/Views/index.js";import f from"/Utils/use-lang.js";import p from"/Utils/load-css.js";import b from"/Utils/use-toggle.js";import g from"/Components/list-limit.js";import{getRitoCardsFromDataDump as N}from"/Components/deck/hooks/use-filterable-rito-card-list.js";import x from"/Utils/use-asset-cache.js";import{getRitoCards as k,patchRitoCards as v,getLatestRitoData as y,getCardList as C,getCard as w,saveCard as h,deleteCard as j}from"/Utils/service.js";import A from"/Components/deck/card-name.js";import U from"/cdn/object-hash";const _=p("/Components/card-config/edit-associated-cards.css");export default e((function(e){const s=f(),p=!0===d(u).state.settings.lowSpecsMode,[w,h]=b(!1),[j,_]=i("custom"),S=n({}),[V,z]=i();m((()=>{k().then((e=>{let a;z(a=N(e)),Array.prototype.forEach.call(a||[],(e=>{e&&(S.current[e.cardCode]=e)}))}))}),[]);const[E,L]=i(!1),$=l((()=>{E||(L(!0),y().then((async e=>{await v(e),z(N(e)),L(!1)})))}),[E]),[M,q]=i([]),[B,D]=i("");m((()=>{if(!Array.isArray(V))return;const e=V.filter((e=>e&&e.name.toLowerCase().includes(B)));q(e)}),[B,V]);const F=x((e=>{C({exclude:["deck"]}).then((a=>{e(a),Array.prototype.forEach.call(a,(e=>{S.current[e.id]=e}))}))}),[]),[G,H]=i([]),[I,J]=i("");m((()=>{if(!Array.isArray(F))return;const e=F.filter((e=>e&&e.name&&e.name.toLowerCase().includes(B)));H(e)}),[I,F]);const K=l((a=>{const t={id:a.id,cardCode:a.cardCode,artUrl:a.url},r=U(t);t.key=r;let s=e.value||[];Array.isArray(s)||(s=[]);if(s.some((e=>e.key===r)))return;const c=[t,...s];e.updateValue(c)}),[e.value,e.updateValue]),O=x((a=>{a((e.value||[]).map((e=>S.current[e.id]||S.current[e.cardCode]||e)))}),[e.value,F,V],[]);return a({className:"associated-cards"},t({onClick:h,className:"flex clickable"},a({className:"grow flex vcenter"},r(e.label)),o({className:"gutter-trbl-.5 flex vcenter"},a({className:`icon ${p?"":"animated"} ${w?"multiply":"chevron-down"}`}))),a({className:"gutter-b-2 accordian "+(w?"expanded":"")},c({className:"flex no-wrap tabs gutter-t-.5"},a({className:("custom"===j?"active ":"")+"tab-header grow gutter-trbl-.5 clickable flex vhcenter text-center",onClick:()=>_("custom")},s("custom_cards")),a({className:("rito"===j?"active ":"")+"tab-header grow gutter-trbl-.5 clickable flex vhcenter text-center",onClick:()=>_("rito")},s("official_cards")),a({className:("associated"===j?"active ":"")+"tab-header grow gutter-trbl-.5 clickable flex vhcenter text-center",onClick:()=>_("associated")},e.label)),a({className:"tab-body gutter-t"},"custom"===j?a({className:"gutter-rl"},a(g({defaultSize:p?8:24},(G||[]).map((e=>e?a({className:"flex gutter-b",key:e.id},A({card:e,className:"box-9"},e.name),a({className:"box-3 flex no-wrap"},o({className:"grow gutter-trbl-.5",onClick:()=>K(e)},a({className:"icon link"})))):void 0))))):void 0,"rito"===j?a({className:"gutter-rl"},a(g({defaultSize:p?8:24},(M||[]).map((e=>e?a({className:"flex gutter-b",key:e.cardCode},A({card:e,className:"box-9"},e.name),a({className:"box-3 flex no-wrap"},o({className:"grow gutter-trbl-.5",onClick:()=>K(e)},a({className:"icon link"})))):void 0))),V&&V.length?void 0:a({className:"flex"},o({onClick:$,className:"gutter-trbl-.5 grow"},E?a({className:"icon loading"}):s("load_rito_data"))))):void 0,"associated"===j?a({className:"gutter-rl"},(O||[]).map((e=>e?a({className:"flex gutter-b",key:e.id||e.cardCode||e.url},A({card:e,className:"box-9"},e.name),a({className:"box-3 flex no-wrap"},o({className:"grow gutter-trbl-.5"},a({className:"icon multiply"})))):void 0))):void 0)))}),_);