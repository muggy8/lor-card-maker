import e,{div as a,label as o,strong as t,button as s,fragment as r,select as c,option as l}from"/Utils/elements.js";import n,{components as m}from"/cdn/react-select";import i from"/Utils/use-lang.js";import{useCallback as p,useState as g,useEffect as u,useContext as d,createElement as f}from"/cdn/react";import v from"/Utils/load-css.js";import b from"/Utils/datauri.js";import y from"/Components/card-config/edit-art.js";import h from"/Components/card-template/image-render.js";import N from"/cdn/save-svg-as-png";import{InlineIcon as x}from"/Components/card-template/effect-text.js";import k from"../card-template/svg-wrap.js";import{decimalLimit as w}from"/Components/card-config/edit-shade.js";import{svgRefference as A}from"/Views/card-editor.js";import{Globals as $}from"/Views/index.js";import C from"/Utils/use-toggle.js";import j from"/Utils/use-asset-cache.js";import I from"./edit-rarity.js";import V from"/Components/range-input.js";v("/Components/card-config/edit-icon.css");const U=e(n),_=e(m.Option),P=e(m.SingleValue),L=e(m.Placeholder),q=["negate.png","nou.png","october.png","pierce.png","quiet.png","shards.png","vision.png","avarosa.png","blaze.png","block.png","bolt.png","boot.png","candle.png","crit.png","defend.png","duel.png","eevee.png","ember.png","healing.png","champ.png","chat.png","discovered.png","dislike.png","flag.png","hexigon.png","like.png","pray.png","sword.png"],O=["none","power","relic","item"];function R(e){return _({...e},a({className:"flex vhcenter"},x({url:e.data.icon})))}function S(e){const o=i();return P({...e},a({className:"flex vhcenter gutter-tb-.5"},`${o("base_icon")}: `,x({url:e.data.icon})))}function z(e){return L(e,a({className:"flex vhcenter gutter-tb-1",style:{color:"var(--color-black)"}},e.children))}export default e((function(e){const n=i(),[m,v]=(d($),g(0)),[x,C]=g(1.5),[_,P]=g(0),[L,F]=g(.65),[T,X]=g(1),[B,D]=g(null),[E,G]=g("");u((()=>{B&&(b(B.icon).then(G),v(0),C(1.5),P(0),F(.65),X(1))}),[B]);const[H,J]=g(null),[K,M]=g(!1),Q=p((()=>{K||(M(!0),requestAnimationFrame((()=>{N.svgAsPngUri(H,{excludeUnusedCss:!0,width:H.width.baseVal.value,height:H.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),D(null),G(""),M(!1)}),(()=>M(!1)))})))}),[H,K,e.value]),W=p((()=>{D(null),G(""),M(!1)}),[]),[Y,Z]=g(!1),ee=p((()=>Z(!0))),ae=p((()=>Z(!1))),[oe,te]=g(""),[se,re]=g({x:0,y:0,scale:1}),[ce,le]=g(null),[ne,me]=g(!1);u((()=>{re({x:0,y:0,scale:1}),ae(),ue(!1)}),[oe]);const ie=p((()=>{te("")}),[]),pe=p((()=>{!ne&&Y&&(me(!0),N.svgAsPngUri(ce,{excludeUnusedCss:!0,width:ce.width.baseVal.value,height:ce.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),te(""),me(!1),ae()}),(()=>me(!1))))}),[ce,ne,e.value,Y]),[ge,ue]=g(!1),de=p((e=>{const a=e.target,o=a[a.selectedIndex];"none"===o.value?ue(!1):ue(o.value)}),[]),[fe,ve,be,ye,he,Ne,xe,ke,we,Ae,$e,Ce,je,Ie,Ve,Ue,_e,Pe,Le,qe,Oe,Re,Se]=j((e=>{Promise.all([b("/Assets/keyword/poc-frame-overlay.png"),b("/Assets/keyword/poc-frame-overlay-cover.png"),b("/Assets/keyword/poc-frame-overlay-common.png"),b("/Assets/keyword/poc-frame-overlay-rare.png"),b("/Assets/keyword/poc-frame-overlay-epic.png"),b("/Assets/keyword/poc-frame-overlay-legendary.png"),b("/Assets/keyword/poc-common.png"),b("/Assets/keyword/poc-rare.png"),b("/Assets/keyword/poc-epic.png"),b("/Assets/keyword/poc-legendary.png"),b("/Assets/keyword/poc-special.png"),b("/Assets/keyword/poc-relic-frame.png"),b("/Assets/keyword/poc-relic-frame-overlay-common.png"),b("/Assets/keyword/poc-relic-frame-overlay-rare.png"),b("/Assets/keyword/poc-relic-frame-overlay-epic.png"),b("/Assets/keyword/poc-relic-frame-overlay-legendary.png"),b("/Assets/keyword/poc-relic-frame-overlay-special.png"),b("/Assets/keyword/poc-item-frame.png"),b("/Assets/keyword/poc-item-frame-overlay-common.png"),b("/Assets/keyword/poc-item-frame-overlay-rare.png"),b("/Assets/keyword/poc-item-frame-overlay-epic.png"),b("/Assets/keyword/poc-item-frame-overlay-legendary.png"),b("/Assets/keyword/poc-item-frame-overlay-special.png")]).then(e)}),[],[]),[ze,Fe]=g(""),Te=p((()=>r(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${fe})`}}),a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${ve})`}}),ze?r(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===ze&&be||"rare"===ze&&ye||"epic"===ze&&he||"champion"===ze&&Ne||""})`}}),a({className:"poc-icon poc-gem",style:{backgroundImage:`url(${"common"===ze&&xe||"rare"===ze&&ke||"epic"===ze&&we||"champion"===ze&&Ae||"special"===ze&&$e||""})`}})):void 0)),[ze,fe,ve,be,ye,he,Ne,xe,ke,we,Ae,$e]),Xe=p((()=>r(ze?a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===ze&&je||"rare"===ze&&Ie||"epic"===ze&&Ve||"champion"===ze&&Ue||"special"===ze&&_e||""})`}}):void 0,a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${Ce})`}}),ze?a({className:"poc-icon poc-gem relic",style:{backgroundImage:`url(${"common"===ze&&xe||"rare"===ze&&ke||"epic"===ze&&we||"champion"===ze&&Ae||"special"===ze&&$e||""})`}}):void 0)),[ze,Ce,je,Ie,Ve,Ue,_e,xe,ke,we,Ae,$e]),Be=p((()=>r(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${Pe})`}}),ze?r(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===ze&&Le||"rare"===ze&&qe||"epic"===ze&&Oe||"champion"===ze&&Re||"special"===ze&&Se||""})`}}),a({className:"poc-icon poc-gem item",style:{backgroundImage:`url(${"common"===ze&&xe||"rare"===ze&&ke||"epic"===ze&&we||"champion"===ze&&Ae||"special"===ze&&$e||""})`}})):void 0)),[ze,Pe,Le,qe,Oe,Re,Se,xe,ke,we,Ae,$e]),De=p((()=>{switch(ge){case"power":return"poc-icon crop-power";case"item":return"poc-icon crop-item";case"relic":return"poc-icon crop-relic";default:return""}}),[ge]);return a({className:"edit-icon box"},o(a(n("keyword_icon"))),e.value&&e.value.length?a({className:"gutter-trl-.5"},a(n("icons")),e.value.map(((o,t)=>a({className:"flex gutter-b-.5",key:o},a({className:"box gutter-trbl-.5 existing-icon-bg"},a({className:"existing-icon-preview",style:{backgroundImage:`url(${o})`}})),s({className:"gutter-trbl-1",onClick:()=>{const a=[...e.value];a.splice(t,1),e.updateValue(a)}},"X"))))):void 0,B?void 0:a(a({className:"gutter-trl-.5"},n("upload_icon")),y({value:oe,updateValue:te,moveable:!1}),oe?a(a({className:"flex vhcenter gutter-tb-2"},f(A.Provider,{value:{current:ce,setRef:le}},k({width:256,height:256,loading:ne,onTransform:re,...se},a({className:`icon-svg-content ${De()}`,style:{"--scale":se.scale,"--left":se.x,"--top":se.y}},a({className:"scale-adjuster"},h({url:oe,onImageChanged:ee}))),"power"===ge?Te():void 0,"relic"===ge?Xe():void 0,"item"===ge?Be():void 0))),a({className:"flex gutter-t-.5"},s({className:"box gutter-trbl-1",onClick:pe,[Y?"":"disabled"]:!0},Y?n("use_icon"):a({className:"icon loading"})),a({className:"gutter-r-.5"}),s({className:"gutter-trbl-1",onClick:ie},n("cancel"))),fe?a({className:"gutter-tb"},o(n("poc_mode")),a({className:"gutter-t-.5 flex"},c({onChange:de,className:"grow gutter-trbl",value:ge||"none"},O.map((e=>l({key:e,value:e},n(e))))))):void 0,ge?r(I({value:ze,updateValue:Fe})):void 0):void 0),oe?void 0:a(B?void 0:a({className:"box gutter-rl-.5 gutter-t-.75"},t(n("or"))),a({className:"gutter-trl-.5"},n("create_icon"),a({className:"gutter-t-.5"},U({options:q.map((e=>({value:e,label:e,icon:`/Assets/custom-icon/${e}`}))),components:{Option:R,SingleValue:S,Placeholder:z},placeholder:n("select_base_icon"),onChange:D,value:B}),E?a(a({className:"flex vhcenter gutter-t-.5"},f(A.Provider,{value:{current:H,setRef:J}},k({width:128,height:128,loading:K},a({className:"custom-icon",style:{backgroundImage:E?`url(${E})`:void 0,filter:`brightness(${L}) sepia(${T}) saturate(${_}) hue-rotate(${m}deg) contrast(${x})`}})))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("saturation"),":"),a({className:"grow gutter-t"},V({formatLabel:e=>`${w(100*e)}%`,value:_,min:0,max:5,step:.01,onChange:P}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("hue_rotation"),":"),a({className:"grow gutter-t"},V({formatLabel:e=>`${w(e)}deg`,value:m,min:0,max:360,step:1,onChange:v}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("brightness"),":"),a({className:"grow gutter-t"},V({formatLabel:e=>`${w(100*e)}%`,value:L,min:0,max:2,step:.01,onChange:F}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("contrast"),":"),a({className:"grow gutter-t"},V({formatLabel:e=>`${w(100*e)}%`,value:x,min:0,max:5,step:.01,onChange:C}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("sepia"),":"),a({className:"grow gutter-t"},V({formatLabel:e=>`${w(100*e)}%`,value:T,min:0,max:1,step:.01,onChange:X}))),a({className:"flex gutter-t-.5"},s({className:"box gutter-trbl-1",onClick:Q},n("use_icon")),a({className:"gutter-r-.5"}),s({className:"gutter-trbl-1",onClick:W},n("cancel")))):void 0))))}));