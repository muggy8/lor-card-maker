import e,{div as a,label as o,strong as r,button as s,fragment as t,select as c,option as l}from"/Utils/elements.js";import n,{components as m}from"/cdn/react-select";import i from"/Utils/use-lang.js";import{useCallback as p,useState as g,useEffect as u,useContext as d,createElement as v}from"/cdn/react";import f from"/Utils/load-css.js";import y from"/Utils/datauri.js";import b from"/Components/card-config/edit-art.js";import N from"/Components/card-template/image-render.js";import h from"/cdn/save-svg-as-png";import{InlineIcon as x}from"/Components/card-template/effect-text.js";import k from"../card-template/svg-wrap.js";import{decimalLimit as w}from"/Components/card-config/edit-shade.js";import{svgRefference as A}from"/Views/card-editor.js";import $ from"/Utils/use-asset-cache.js";import C from"/Components/range-input.js";import j from"./edit-rarity-poc.js";f("/Components/card-config/edit-icon.css");const I=e(n),V=e(m.Option),_=e(m.SingleValue),U=e(m.Placeholder),P=["negate.png","nou.png","october.png","pierce.png","quiet.png","shards.png","vision.png","avarosa.png","blaze.png","block.png","bolt.png","boot.png","candle.png","crit.png","defend.png","duel.png","eevee.png","ember.png","healing.png","champ.png","chat.png","discovered.png","dislike.png","flag.png","hexigon.png","like.png","pray.png","sword.png"],L=["none","power","relic","item"];function q(e){return V({...e},a({className:"flex vhcenter"},x({url:e.data.icon})))}function O(e){const o=i();return _({...e},a({className:"flex vhcenter gutter-tb-.5"},`${o("base_icon")}: `,x({url:e.data.icon})))}function R(e){return U(e,a({className:"flex vhcenter gutter-tb-1",style:{color:"var(--color-black)"}},e.children))}export default e((function(e){const n=i(),[m,d]=g(0),[f,x]=g(1.5),[V,_]=g(0),[U,S]=g(.65),[z,F]=g(1),[T,X]=g(null),[B,D]=g("");u((()=>{T&&(y(T.icon).then(D),d(0),x(1.5),_(0),S(.65),F(1))}),[T]);const[E,G]=g(null),[H,J]=g(!1),K=p((()=>{H||(J(!0),requestAnimationFrame((()=>{h.svgAsPngUri(E,{excludeUnusedCss:!0,width:E.width.baseVal.value,height:E.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),X(null),D(""),J(!1)}),(()=>J(!1)))})))}),[E,H,e.value]),M=p((()=>{X(null),D(""),J(!1)}),[]),[Q,W]=g(!1),Y=p((()=>W(!0))),Z=p((()=>W(!1))),[ee,ae]=g(""),[oe,re]=g({x:0,y:0,scale:1}),[se,te]=g(null),[ce,le]=g(!1);u((()=>{re({x:0,y:0,scale:1}),Z(),pe(!1)}),[ee]);const ne=p((()=>{ae("")}),[]),me=p((()=>{!ce&&Q&&(le(!0),h.svgAsPngUri(se,{excludeUnusedCss:!0,width:se.width.baseVal.value,height:se.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),ae(""),le(!1),Z()}),(()=>le(!1))))}),[se,ce,e.value,Q]),[ie,pe]=g(!1),ge=p((e=>{const a=e.target,o=a[a.selectedIndex];"none"===o.value?pe(!1):pe(o.value)}),[]),[ue,de,ve,fe,ye,be,Ne,he,xe,ke,we,Ae,$e,Ce,je,Ie,Ve,_e,Ue,Pe,Le,qe,Oe,Re]=$((e=>{Promise.all([y("/Assets/keyword/poc-frame-overlay.png"),y("/Assets/keyword/poc-frame-overlay-cover.png"),y("/Assets/keyword/poc-frame-overlay-common.png"),y("/Assets/keyword/poc-frame-overlay-rare.png"),y("/Assets/keyword/poc-frame-overlay-epic.png"),y("/Assets/keyword/poc-frame-overlay-legendary.png"),y("/Assets/keyword/poc-frame-overlay-special.png"),y("/Assets/keyword/poc-common.png"),y("/Assets/keyword/poc-rare.png"),y("/Assets/keyword/poc-epic.png"),y("/Assets/keyword/poc-legendary.png"),y("/Assets/keyword/poc-special.png"),y("/Assets/keyword/poc-relic-frame.png"),y("/Assets/keyword/poc-relic-frame-overlay-common.png"),y("/Assets/keyword/poc-relic-frame-overlay-rare.png"),y("/Assets/keyword/poc-relic-frame-overlay-epic.png"),y("/Assets/keyword/poc-relic-frame-overlay-legendary.png"),y("/Assets/keyword/poc-relic-frame-overlay-special.png"),y("/Assets/keyword/poc-item-frame.png"),y("/Assets/keyword/poc-item-frame-overlay-common.png"),y("/Assets/keyword/poc-item-frame-overlay-rare.png"),y("/Assets/keyword/poc-item-frame-overlay-epic.png"),y("/Assets/keyword/poc-item-frame-overlay-legendary.png"),y("/Assets/keyword/poc-item-frame-overlay-special.png")]).then(e)}),[],[]),[Se,ze]=g(""),Fe=p((()=>t(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${ue})`}}),a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${de})`}}),Se?t(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===Se&&ve||"rare"===Se&&fe||"epic"===Se&&ye||"legendary"===Se&&be||"special"===Se&&Ne||""})`}}),a({className:`poc-icon poc-gem poc-gem-${Se}`,style:{backgroundImage:`url(${"common"===Se&&he||"rare"===Se&&xe||"epic"===Se&&ke||"legendary"===Se&&we||"special"===Se&&Ae||""})`}})):void 0)),[Se,ue,de,ve,fe,ye,be,Ne,he,xe,ke,we,Ae]),Te=p((()=>t(Se?a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===Se&&Ce||"rare"===Se&&je||"epic"===Se&&Ie||"legendary"===Se&&Ve||"special"===Se&&_e||""})`}}):void 0,a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${$e})`}}),Se?a({className:`poc-icon poc-gem poc-gem-${Se} relic`,style:{backgroundImage:`url(${"common"===Se&&he||"rare"===Se&&xe||"epic"===Se&&ke||"legendary"===Se&&we||"special"===Se&&Ae||""})`}}):void 0)),[Se,$e,Ce,je,Ie,Ve,_e,he,xe,ke,we,Ae]),Xe=p((()=>t(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${Ue})`}}),Se?t(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===Se&&Pe||"rare"===Se&&Le||"epic"===Se&&qe||"legendary"===Se&&Oe||"special"===Se&&Re||""})`}}),a({className:`poc-icon poc-gem poc-gem-${Se} item`,style:{backgroundImage:`url(${"common"===Se&&he||"rare"===Se&&xe||"epic"===Se&&ke||"legendary"===Se&&we||"special"===Se&&Ae||""})`}})):void 0)),[Se,Ue,Pe,Le,qe,Oe,Re,he,xe,ke,we,Ae]),Be=p((()=>{switch(ie){case"power":return"poc-icon crop-power";case"item":return"poc-icon crop-item";case"relic":return"poc-icon crop-relic";default:return""}}),[ie]);return a({className:"edit-icon box"},o(a(n("keyword_icon"))),e.value&&e.value.length?a({className:"gutter-trl-.5"},a(n("icons")),e.value.map(((o,r)=>a({className:"flex gutter-b-.5",key:o},a({className:"box gutter-trbl-.5 existing-icon-bg"},a({className:"existing-icon-preview",style:{backgroundImage:`url(${o})`}})),s({className:"gutter-trbl-1",onClick:()=>{const a=[...e.value];a.splice(r,1),e.updateValue(a)}},"X"))))):void 0,T?void 0:a(a({className:"gutter-trl-.5"},n("upload_icon")),b({value:ee,updateValue:ae,moveable:!1}),ee?a(a({className:"flex vhcenter gutter-tb-2"},v(A.Provider,{value:{current:se,setRef:te}},k({width:256,height:256,loading:ce,onTransform:re,...oe},a({className:`icon-svg-content ${Be()}`,style:{"--scale":oe.scale,"--left":oe.x,"--top":oe.y}},a({className:"scale-adjuster"},N({url:ee,onImageChanged:Y}))),"power"===ie?Fe():void 0,"relic"===ie?Te():void 0,"item"===ie?Xe():void 0))),ue?a({className:"gutter-tb"},o(n("poc_mode")),a({className:"gutter-t-.5 flex"},c({onChange:ge,className:"grow gutter-trbl",value:ie||"none"},L.map((e=>l({key:e,value:e},n(e))))))):void 0,ie?t(j({value:Se,updateValue:ze})):void 0,a({className:"flex gutter-t-.5"},s({className:"box gutter-trbl-1",onClick:me,[Q?"":"disabled"]:!0},Q?n("use_icon"):a({className:"icon loading"})),a({className:"gutter-r-.5"}),s({className:"gutter-trbl-1",onClick:ne},n("cancel")))):void 0),ee?void 0:a(T?void 0:a({className:"box gutter-rl-.5 gutter-t-.75"},r(n("or"))),a({className:"gutter-trl-.5"},n("create_icon"),a({className:"gutter-t-.5"},I({options:P.map((e=>({value:e,label:e,icon:`/Assets/custom-icon/${e}`}))),components:{Option:q,SingleValue:O,Placeholder:R},placeholder:n("select_base_icon"),onChange:X,value:T}),B?a(a({className:"flex vhcenter gutter-t-.5"},v(A.Provider,{value:{current:E,setRef:G}},k({width:128,height:128,loading:H},a({className:"custom-icon",style:{backgroundImage:B?`url(${B})`:void 0,filter:`brightness(${U}) sepia(${z}) saturate(${V}) hue-rotate(${m}deg) contrast(${f})`}})))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("saturation"),":"),a({className:"grow gutter-t"},C({formatLabel:e=>`${w(100*e)}%`,value:V,min:0,max:5,step:.01,onChange:_}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("hue_rotation"),":"),a({className:"grow gutter-t"},C({formatLabel:e=>`${w(e)}deg`,value:m,min:0,max:360,step:1,onChange:d}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("brightness"),":"),a({className:"grow gutter-t"},C({formatLabel:e=>`${w(100*e)}%`,value:U,min:0,max:2,step:.01,onChange:S}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("contrast"),":"),a({className:"grow gutter-t"},C({formatLabel:e=>`${w(100*e)}%`,value:f,min:0,max:5,step:.01,onChange:x}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("sepia"),":"),a({className:"grow gutter-t"},C({formatLabel:e=>`${w(100*e)}%`,value:z,min:0,max:1,step:.01,onChange:F}))),a({className:"flex gutter-t-.5"},s({className:"box gutter-trbl-1",onClick:K},n("use_icon")),a({className:"gutter-r-.5"}),s({className:"gutter-trbl-1",onClick:M},n("cancel")))):void 0))))}));