import e,{div as t,label as a,strong as s,button as l,fragment as r,select as n,option as o}from"/Utils/elements.js";import c,{components as i}from"/cdn/react-select";import g from"/Utils/use-lang.js";import{useCallback as m,useState as u,useEffect as p,useContext as d,createElement as b}from"/cdn/react";import f from"/Utils/load-css.js";import v from"/Utils/datauri.js";import h from"/Components/card-config/edit-art.js";import x from"/Components/card-template/image-render.js";import N from"/cdn/save-svg-as-png";import{InlineIcon as C}from"/Components/card-template/effect-text.js";import w from"../card-template/svg-wrap.js";import{decimalLimit as j}from"/Components/card-config/edit-shade.js";import{svgRefference as $}from"/Views/card-editor.js";import k from"/Utils/use-asset-cache.js";import y from"/Components/range-input.js";import V from"./edit-rarity-poc.js";f("/Components/card-config/edit-icon.css");const U=e(c),_=e(i.Option),P=e(i.SingleValue),L=e(i.Placeholder),A=["negate.png","nou.png","october.png","pierce.png","quiet.png","shards.png","vision.png","avarosa.png","blaze.png","block.png","bolt.png","boot.png","candle.png","crit.png","defend.png","duel.png","eevee.png","ember.png","healing.png","champ.png","chat.png","discovered.png","dislike.png","flag.png","hexigon.png","like.png","pray.png","sword.png"];function I(e){return _({...e},t({className:"flex vhcenter"},C({url:e.data.icon})))}function q(e){const a=g();return P({...e},t({className:"flex vhcenter gutter-tb-.5"},`${a("base_icon")}: `,C({url:e.data.icon})))}function O(e){return L(e,t({className:"flex vhcenter gutter-tb-1",style:{color:"var(--color-black)"}},e.children))}export default e((function(e){const r=g(),[n,o]=u(0),[c,i]=u(1.5),[d,f]=u(0),[C,k]=u(.65),[V,_]=u(1),[P,L]=u(null),[R,S]=u("");p((()=>{P&&(v(P.icon).then(S),o(0),i(1.5),f(0),k(.65),_(1))}),[P]);const[z,F]=u(null),[T,X]=u(!1),B=m((()=>{T||(X(!0),requestAnimationFrame((()=>{N.svgAsPngUri(z,{excludeUnusedCss:!0,width:z.width.baseVal.value,height:z.height.baseVal.value}).then((t=>{e.updateValue([...e.value||[],t]),L(null),S(""),X(!1)}),(()=>X(!1)))})))}),[z,T,e.value]),D=m((()=>{L(null),S(""),X(!1)}),[]),[E,G]=u(!1),H=m((()=>G(!0))),J=m((()=>G(!1))),[K,M]=u(""),[Q,W]=u({x:0,y:0,scale:1}),[Y,Z]=u(null),[ee,te]=u(!1);p((()=>{W({x:0,y:0,scale:1}),J()}),[K]);const ae=m((()=>{M("")}),[]),se=m((()=>{!ee&&E&&(te(!0),N.svgAsPngUri(Y,{excludeUnusedCss:!0,width:Y.width.baseVal.value,height:Y.height.baseVal.value}).then((t=>{e.updateValue([...e.value||[],t]),M(""),te(!1),J()}),(()=>te(!1))))}),[Y,ee,e.value,E]);return t({className:"edit-icon box"},a(t(r("keyword_icon"))),e.value&&e.value.length?t({className:"gutter-trl-.5"},t(r("icons")),e.value.map(((a,s)=>t({className:"flex gutter-b-.5",key:a},t({className:"box gutter-trbl-.5 existing-icon-bg"},t({className:"existing-icon-preview",style:{backgroundImage:`url(${a})`}})),l({className:"gutter-trbl-1",onClick:()=>{const t=[...e.value];t.splice(s,1),e.updateValue(t)}},"X"))))):void 0,P?void 0:t(t({className:"gutter-trl-.5"},r("upload_icon")),h({value:K,updateValue:M,moveable:!1}),K?t(t({className:"flex vhcenter gutter-tb-2"},b($.Provider,{value:{current:Y,setRef:Z}},w({width:256,height:256,loading:ee,onTransform:W,...Q},t({className:"icon-svg-content",style:{"--scale":Q.scale,"--left":Q.x,"--top":Q.y}},t({className:"scale-adjuster"},x({url:K,onImageChanged:H})))))),t({className:"flex gutter-t-.5"},l({className:"box gutter-trbl-1",onClick:se,...E?{}:{disabled:!0}},E?r("use_icon"):t({className:"icon loading"})),t({className:"gutter-r-.5"}),l({className:"gutter-trbl-1",onClick:ae},r("cancel")))):void 0),K?void 0:t(P?void 0:t({className:"box gutter-rl-.5 gutter-t-.75"},s(r("or"))),t({className:"gutter-trl-.5"},r("create_icon"),t({className:"gutter-t-.5"},U({options:A.map((e=>({value:e,label:e,icon:`/Assets/custom-icon/${e}`}))),components:{Option:I,SingleValue:q,Placeholder:O},placeholder:r("select_base_icon"),onChange:L,value:P}),R?t(t({className:"flex vhcenter gutter-t-.5"},b($.Provider,{value:{current:z,setRef:F}},w({width:128,height:128,loading:T},t({className:"custom-icon",style:{backgroundImage:R?`url(${R})`:void 0,filter:`brightness(${C}) sepia(${V}) saturate(${d}) hue-rotate(${n}deg) contrast(${c})`}})))),a({className:"box gutter-trbl-.5 flex-s"},t({className:"box-4 flex vcenter gutter-t"},r("saturation"),":"),t({className:"grow gutter-t"},y({formatLabel:e=>`${j(100*e)}%`,value:d,min:0,max:5,step:.01,onChange:f}))),a({className:"box gutter-trbl-.5 flex-s"},t({className:"box-4 flex vcenter gutter-t"},r("hue_rotation"),":"),t({className:"grow gutter-t"},y({formatLabel:e=>`${j(e)}deg`,value:n,min:0,max:360,step:1,onChange:o}))),a({className:"box gutter-trbl-.5 flex-s"},t({className:"box-4 flex vcenter gutter-t"},r("brightness"),":"),t({className:"grow gutter-t"},y({formatLabel:e=>`${j(100*e)}%`,value:C,min:0,max:2,step:.01,onChange:k}))),a({className:"box gutter-trbl-.5 flex-s"},t({className:"box-4 flex vcenter gutter-t"},r("contrast"),":"),t({className:"grow gutter-t"},y({formatLabel:e=>`${j(100*e)}%`,value:c,min:0,max:5,step:.01,onChange:i}))),a({className:"box gutter-trbl-.5 flex-s"},t({className:"box-4 flex vcenter gutter-t"},r("sepia"),":"),t({className:"grow gutter-t"},y({formatLabel:e=>`${j(100*e)}%`,value:V,min:0,max:1,step:.01,onChange:_}))),t({className:"flex gutter-t-.5"},l({className:"box gutter-trbl-1",onClick:B},r("use_icon")),t({className:"gutter-r-.5"}),l({className:"gutter-trbl-1",onClick:D},r("cancel")))):void 0))))}));