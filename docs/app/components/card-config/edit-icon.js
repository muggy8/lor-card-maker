import e,{div as a,label as o,strong as s,button as r,InputRange as t,fragment as l,select as c,option as n}from"/Utils/elements.js";import m,{components as i}from"/cdn/react-select";import p from"/Utils/use-lang.js";import{useCallback as g,useState as u,useEffect as d,useContext as v,createElement as f}from"/cdn/react";import b from"/Utils/load-css.js";import y from"/Utils/datauri.js";import h from"/Components/card-config/edit-art.js";import N from"/Components/card-template/image-render.js";import k from"/cdn/save-svg-as-png";import{InlineIcon as w}from"/Components/card-template/effect-text.js";import x from"../card-template/svg-wrap.js";import{decimalLimit as A}from"/Components/card-config/edit-shade.js";import{svgRefference as $}from"/Views/card-editor.js";import{Globals as V}from"/Views/index.js";import C from"/Utils/use-toggle.js";import j from"/Utils/use-asset-cache.js";import I from"./edit-rarity.js";b("/Components/card-config/edit-icon.css");const U=e(m),_=e(i.Option),P=e(i.SingleValue),L=e(i.Placeholder),q=["negate.png","nou.png","october.png","pierce.png","quiet.png","shards.png","vision.png","avarosa.png","blaze.png","block.png","bolt.png","boot.png","candle.png","crit.png","defend.png","duel.png","eevee.png","ember.png","healing.png","champ.png","chat.png","discovered.png","dislike.png","flag.png","hexigon.png","like.png","pray.png","sword.png"],O=["none","power","relic","item"];function R(e){return _({...e},a({className:"flex vhcenter"},w({url:e.data.icon})))}function S(e){const o=p();return P({...e},a({className:"flex vhcenter gutter-tb-.5"},`${o("base_icon")}: `,w({url:e.data.icon})))}function z(e){return L(e,a({className:"flex vhcenter gutter-tb-1",style:{color:"var(--color-black)"}},e.children))}export default e((function(e){const m=p(),[i,b]=(v(V),u(0)),[w,C]=u(1),[_,P]=u(0),[L,F]=u(1),[T,X]=u(1),[B,D]=u(null),[E,G]=u("");d((()=>{B&&(y(B.icon).then(G),b(0),C(1),P(0),F(1),X(1))}),[B]);const[H,J]=u(null),[K,M]=u(!1),Q=g((()=>{K||(M(!0),requestAnimationFrame((()=>{k.svgAsPngUri(H,{excludeUnusedCss:!0,width:H.width.baseVal.value,height:H.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),D(null),G(""),M(!1)}),(()=>M(!1)))})))}),[H,K,e.value]),W=g((()=>{D(null),G(""),M(!1)}),[]),[Y,Z]=u(!1),ee=g((()=>Z(!0))),ae=g((()=>Z(!1))),[oe,se]=u(""),[re,te]=u({x:0,y:0,scale:1}),[le,ce]=u(null),[ne,me]=u(!1);d((()=>{te({x:0,y:0,scale:1}),ae(),ue(!1)}),[oe]);const ie=g((()=>{se("")}),[]),pe=g((()=>{!ne&&Y&&(me(!0),k.svgAsPngUri(le,{excludeUnusedCss:!0,width:le.width.baseVal.value,height:le.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),se(""),me(!1),ae()}),(()=>me(!1))))}),[le,ne,e.value,Y]),[ge,ue]=u(!1),de=g((e=>{const a=e.target,o=a[a.selectedIndex];"none"===o.value?ue(!1):ue(o.value)}),[]),[ve,fe,be,ye,he,Ne,ke,we,xe,Ae,$e,Ve,Ce,je,Ie,Ue,_e,Pe,Le,qe,Oe,Re,Se]=j((e=>{Promise.all([y("/Assets/keyword/poc-frame-overlay.png"),y("/Assets/keyword/poc-frame-overlay-cover.png"),y("/Assets/keyword/poc-frame-overlay-common.png"),y("/Assets/keyword/poc-frame-overlay-rare.png"),y("/Assets/keyword/poc-frame-overlay-epic.png"),y("/Assets/keyword/poc-frame-overlay-legendary.png"),y("/Assets/keyword/poc-common.png"),y("/Assets/keyword/poc-rare.png"),y("/Assets/keyword/poc-epic.png"),y("/Assets/keyword/poc-legendary.png"),y("/Assets/keyword/poc-special.png"),y("/Assets/keyword/poc-relic-frame.png"),y("/Assets/keyword/poc-relic-frame-overlay-common.png"),y("/Assets/keyword/poc-relic-frame-overlay-rare.png"),y("/Assets/keyword/poc-relic-frame-overlay-epic.png"),y("/Assets/keyword/poc-relic-frame-overlay-legendary.png"),y("/Assets/keyword/poc-relic-frame-overlay-special.png"),y("/Assets/keyword/poc-item-frame.png"),y("/Assets/keyword/poc-item-frame-overlay-common.png"),y("/Assets/keyword/poc-item-frame-overlay-rare.png"),y("/Assets/keyword/poc-item-frame-overlay-epic.png"),y("/Assets/keyword/poc-item-frame-overlay-legendary.png"),y("/Assets/keyword/poc-item-frame-overlay-special.png")]).then(e)}),[],[]),[ze,Fe]=u(""),Te=g((()=>l(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${ve})`}}),a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${fe})`}}),ze?l(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===ze&&be||"rare"===ze&&ye||"epic"===ze&&he||"champion"===ze&&Ne||""})`}}),a({className:"poc-icon poc-gem",style:{backgroundImage:`url(${"common"===ze&&ke||"rare"===ze&&we||"epic"===ze&&xe||"champion"===ze&&Ae||"special"===ze&&$e||""})`}})):void 0)),[ze,ve,fe,be,ye,he,Ne,ke,we,xe,Ae,$e]),Xe=g((()=>l(ze?a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===ze&&Ce||"rare"===ze&&je||"epic"===ze&&Ie||"champion"===ze&&Ue||"special"===ze&&_e||""})`}}):void 0,a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${Ve})`}}),ze?a({className:"poc-icon poc-gem relic",style:{backgroundImage:`url(${"common"===ze&&ke||"rare"===ze&&we||"epic"===ze&&xe||"champion"===ze&&Ae||"special"===ze&&$e||""})`}}):void 0)),[ze,Ve,Ce,je,Ie,Ue,_e,ke,we,xe,Ae,$e]),Be=g((()=>l(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${Pe})`}}),ze?l(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===ze&&Le||"rare"===ze&&qe||"epic"===ze&&Oe||"champion"===ze&&Re||"special"===ze&&Se||""})`}}),a({className:"poc-icon poc-gem item",style:{backgroundImage:`url(${"common"===ze&&ke||"rare"===ze&&we||"epic"===ze&&xe||"champion"===ze&&Ae||"special"===ze&&$e||""})`}})):void 0)),[ze,Pe,Le,qe,Oe,Re,Se,ke,we,xe,Ae,$e]),De=g((()=>{switch(ge){case"power":return"poc-icon crop-power";case"item":return"poc-icon crop-item";case"relic":return"poc-icon crop-relic";default:return""}}),[ge]);return a({className:"edit-icon box"},o(a(m("keyword_icon"))),e.value&&e.value.length?a({className:"gutter-trl-.5"},a(m("icons")),e.value.map(((o,s)=>a({className:"flex gutter-b-.5",key:o},a({className:"box gutter-trbl-.5 existing-icon-bg"},a({className:"existing-icon-preview",style:{backgroundImage:`url(${o})`}})),r({className:"gutter-trbl-1",onClick:()=>{const a=[...e.value];a.splice(s,1),e.updateValue(a)}},"X"))))):void 0,B?void 0:a(a({className:"gutter-trl-.5"},m("upload_icon")),h({value:oe,updateValue:se,moveable:!1}),oe?a(a({className:"flex vhcenter gutter-tb-2"},f($.Provider,{value:{current:le,setRef:ce}},x({width:256,height:256,loading:ne,onTransform:te,...re},a({className:`icon-svg-content ${De()}`,style:{"--scale":re.scale,"--left":re.x,"--top":re.y}},a({className:"scale-adjuster"},N({url:oe,onImageChanged:ee}))),"power"===ge?Te():void 0,"relic"===ge?Xe():void 0,"item"===ge?Be():void 0))),a({className:"flex gutter-t-.5"},r({className:"box gutter-trbl-1",onClick:pe,[Y?"":"disabled"]:!0},Y?m("use_icon"):a({className:"icon loading"})),a({className:"gutter-r-.5"}),r({className:"gutter-trbl-1",onClick:ie},m("cancel"))),ve?a({className:"gutter-tb"},o(m("poc_mode")),a({className:"gutter-t-.5 flex"},c({onChange:de,className:"grow gutter-trbl",value:ge||"none"},O.map((e=>n({key:e,value:e},m(e))))))):void 0,ge?l(I({value:ze,updateValue:Fe})):void 0):void 0),oe?void 0:a(B?void 0:a({className:"box gutter-rl-.5 gutter-t-.75"},s(m("or"))),a({className:"gutter-trl-.5"},m("create_icon"),a({className:"gutter-t-.5"},U({options:q.map((e=>({value:e,label:e,icon:`/Assets/custom-icon/${e}`}))),components:{Option:R,SingleValue:S,Placeholder:z},placeholder:m("select_base_icon"),onChange:D,value:B}),E?a(a({className:"flex vhcenter gutter-t-.5"},f($.Provider,{value:{current:H,setRef:J}},x({width:128,height:128,loading:K},a({className:"custom-icon",style:{backgroundImage:E?`url(${E})`:void 0,filter:`brightness(${L}) sepia(${T}) saturate(${_}) hue-rotate(${i}deg) contrast(${w})`}})))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},m("saturation"),":"),a({className:"grow gutter-tb"},t({formatLabel:e=>`${A(100*e)}%`,value:_,minValue:0,maxValue:5,step:.01,onChange:P}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},m("hue_rotation"),":"),a({className:"grow gutter-tb"},t({formatLabel:e=>`${A(e)}deg`,value:i,minValue:0,maxValue:360,step:1,onChange:b}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},m("brightness"),":"),a({className:"grow gutter-tb"},t({formatLabel:e=>`${A(100*e)}%`,value:L,minValue:0,maxValue:2,step:.01,onChange:F}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},m("contrast"),":"),a({className:"grow gutter-tb"},t({formatLabel:e=>`${A(100*e)}%`,value:w,minValue:0,maxValue:5,step:.01,onChange:C}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},m("sepia"),":"),a({className:"grow gutter-tb"},t({formatLabel:e=>`${A(100*e)}%`,value:T,minValue:0,maxValue:1,step:.01,onChange:X}))),a({className:"flex gutter-t-.5"},r({className:"box gutter-trbl-1",onClick:Q},m("use_icon")),a({className:"gutter-r-.5"}),r({className:"gutter-trbl-1",onClick:W},m("cancel")))):void 0))))}));