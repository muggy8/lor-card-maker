import e,{div as a,label as t,strong as s,button as o,InputRange as r,fragment as l}from"/Utils/elements.js";import n,{components as c}from"/cdn/react-select";import i from"/Utils/use-lang.js";import{useCallback as m,useState as g,useEffect as u,useContext as p,createElement as d}from"/cdn/react";import b from"/Utils/load-css.js";import f from"/Utils/datauri.js";import v from"/Components/card-config/edit-art.js";import h from"/Components/card-template/image-render.js";import N from"/cdn/save-svg-as-png";import{InlineIcon as x}from"/Components/card-template/effect-text.js";import y from"../card-template/svg-wrap.js";import{decimalLimit as w}from"/Components/card-config/edit-shade.js";import{svgRefference as k}from"/Views/card-editor.js";import{Globals as V}from"/Views/index.js";import{openUri as C}from"/Views/card-editor.js";import $ from"/Utils/use-toggle.js";import j from"/Utils/use-asset-cache.js";import A from"./edit-rarity.js";b("/Components/card-config/edit-icon.css");const _=e(n),U=e(c.Option),I=e(c.SingleValue),P=e(c.Placeholder),L=["negate.png","nou.png","october.png","pierce.png","quiet.png","shards.png","vision.png","avarosa.png","blaze.png","block.png","bolt.png","boot.png","candle.png","crit.png","defend.png","duel.png","eevee.png","ember.png","healing.png","champ.png","chat.png","discovered.png","dislike.png","flag.png","hexigon.png","like.png","pray.png","sword.png"];function q(e){return U({...e},a({className:"flex vhcenter"},x({url:e.data.icon})))}function O(e){const t=i();return I({...e},a({className:"flex vhcenter gutter-tb-.5"},`${t("base_icon")}: `,x({url:e.data.icon})))}function R(e){return P(e,a({className:"flex vhcenter gutter-tb-1",style:{color:"var(--color-black)"}},e.children))}export default e((function(e){const n=i(),[c,b]=(p(V),g(0)),[x,C]=g(1),[U,I]=g(0),[P,S]=g(1),[z,F]=g(1),[T,X]=g(null),[B,D]=g("");u((()=>{T&&(f(T.icon).then(D),b(0),C(1),I(0),S(1),F(1))}),[T]);const[E,G]=g(null),[H,J]=g(!1),K=m((()=>{H||(J(!0),requestAnimationFrame((()=>{N.svgAsPngUri(E,{excludeUnusedCss:!0,width:E.width.baseVal.value,height:E.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),X(null),D(""),J(!1)}),(()=>J(!1)))})))}),[E,H,e.value]),M=m((()=>{X(null),D(""),J(!1)}),[]),[Q,W]=g(!1),Y=m((()=>W(!0))),Z=m((()=>W(!1))),[ee,ae]=g(""),[te,se]=g({x:0,y:0,scale:1}),[oe,re]=g(null),[le,ne]=g(!1);u((()=>{se({x:0,y:0,scale:1}),Z(),ue(!1)}),[ee]);const ce=m((()=>{ae("")}),[]),ie=m((()=>{!le&&Q&&(ne(!0),N.svgAsPngUri(oe,{excludeUnusedCss:!0,width:oe.width.baseVal.value,height:oe.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),ae(""),ne(!1),Z()}),(()=>ne(!1))))}),[oe,le,e.value,Q]),[me,ge,ue]=$(!1),[pe,de,be,fe,ve,he,Ne,xe,ye,we]=j((e=>{Promise.all([f("/Assets/keyword/poc-frame-overlay.png"),f("/Assets/keyword/poc-frame-overlay-cover.png"),f("/Assets/keyword/poc-frame-overlay-common.png"),f("/Assets/keyword/poc-frame-overlay-rare.png"),f("/Assets/keyword/poc-frame-overlay-epic.png"),f("/Assets/keyword/poc-frame-overlay-legendary.png"),f("/Assets/keyword/poc-common.png"),f("/Assets/keyword/poc-rare.png"),f("/Assets/keyword/poc-epic.png"),f("/Assets/keyword/poc-legendary.png")]).then(e)}),[],[]),[ke,Ve]=g("");return a({className:"edit-icon box"},t(a(n("keyword_icon"))),e.value&&e.value.length?a({className:"gutter-trl-.5"},a(n("icons")),e.value.map(((t,s)=>a({className:"flex gutter-b-.5",key:t},a({className:"box gutter-trbl-.5 existing-icon-bg"},a({className:"existing-icon-preview",style:{backgroundImage:`url(${t})`}})),o({className:"gutter-trbl-1",onClick:()=>{const a=[...e.value];a.splice(s,1),e.updateValue(a)}},"X"))))):void 0,T?void 0:a(a({className:"gutter-trl-.5"},n("upload_icon")),v({value:ee,updateValue:ae,moveable:!1}),ee?a(a({className:"flex vhcenter gutter-tb-2"},d(k.Provider,{value:{current:oe,setRef:re}},y({width:256,height:256,loading:le,onTransform:se,...te},a({className:"icon-svg-content "+(me?"poc-icon crop":""),style:{"--scale":te.scale,"--left":te.x,"--top":te.y}},a({className:"scale-adjuster"},h({url:ee,onImageChanged:Y}))),me?l(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${pe})`}}),a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${de})`}}),ke?l(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===ke&&be||"rare"===ke&&fe||"epic"===ke&&ve||"champion"===ke&&he||""})`}}),a({className:"poc-icon poc-gem",style:{backgroundImage:`url(${"common"===ke&&Ne||"rare"===ke&&xe||"epic"===ke&&ye||"champion"===ke&&we||""})`}})):void 0):void 0))),a({className:"flex gutter-t-.5"},o({className:"box gutter-trbl-1",onClick:ie,[Q?"":"disabled"]:!0},Q?n("use_icon"):a({className:"icon loading"})),a({className:"gutter-r-.5"}),o({className:"gutter-trbl-1",onClick:ce},n("cancel"))),pe?a({className:"flex gutter-t"},o({className:"gutter-trbl-1 grow",onClick:ge},n(me?"turn_poc_off":"turn_poc_on"))):void 0,me?l(A({value:ke,updateValue:Ve})):void 0):void 0),ee?void 0:a(T?void 0:a({className:"box gutter-rl-.5 gutter-t-.75"},s(n("or"))),a({className:"gutter-trl-.5"},n("create_icon"),a({className:"gutter-t-.5"},_({options:L.map((e=>({value:e,label:e,icon:`/Assets/custom-icon/${e}`}))),components:{Option:q,SingleValue:O,Placeholder:R},placeholder:n("select_base_icon"),onChange:X,value:T}),B?a(a({className:"flex vhcenter gutter-t-.5"},d(k.Provider,{value:{current:E,setRef:G}},y({width:128,height:128,loading:H},a({className:"custom-icon",style:{backgroundImage:B?`url(${B})`:void 0,filter:`brightness(${P}) sepia(${z}) saturate(${U}) hue-rotate(${c}deg) contrast(${x})`}})))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("saturation"),":"),a({className:"grow gutter-tb"},r({formatLabel:e=>`${w(100*e)}%`,value:U,minValue:0,maxValue:5,step:.01,onChange:I}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("hue_rotation"),":"),a({className:"grow gutter-tb"},r({formatLabel:e=>`${w(e)}deg`,value:c,minValue:0,maxValue:360,step:1,onChange:b}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("brightness"),":"),a({className:"grow gutter-tb"},r({formatLabel:e=>`${w(100*e)}%`,value:P,minValue:0,maxValue:2,step:.01,onChange:S}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("contrast"),":"),a({className:"grow gutter-tb"},r({formatLabel:e=>`${w(100*e)}%`,value:x,minValue:0,maxValue:5,step:.01,onChange:C}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("sepia"),":"),a({className:"grow gutter-tb"},r({formatLabel:e=>`${w(100*e)}%`,value:z,minValue:0,maxValue:1,step:.01,onChange:F}))),a({className:"flex gutter-t-.5"},o({className:"box gutter-trbl-1",onClick:K},n("use_icon")),a({className:"gutter-r-.5"}),o({className:"gutter-trbl-1",onClick:M},n("cancel")))):void 0))))}));