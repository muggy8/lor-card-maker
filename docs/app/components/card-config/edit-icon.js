import e,{div as a,label as t,strong as s,button as o,InputRange as l,fragment as r}from"/Utils/elements.js";import n,{components as c}from"/cdn/react-select";import i from"/Utils/use-lang.js";import{useCallback as m,useState as g,useEffect as u,useContext as p,createElement as d}from"/cdn/react";import b from"/Utils/load-css.js";import f from"/Utils/datauri.js";import v from"/Components/card-config/edit-art.js";import h from"/Components/card-template/image-render.js";import N from"/cdn/save-svg-as-png";import{InlineIcon as x}from"/Components/card-template/effect-text.js";import y from"../card-template/svg-wrap.js";import{decimalLimit as k}from"/Components/card-config/edit-shade.js";import{svgRefference as w}from"/Views/card-editor.js";import{Globals as V}from"/Views/index.js";import C from"/Utils/use-toggle.js";import $ from"/Utils/use-asset-cache.js";import j from"./edit-rarity.js";b("/Components/card-config/edit-icon.css");const A=e(n),_=e(c.Option),U=e(c.SingleValue),I=e(c.Placeholder),P=["negate.png","nou.png","october.png","pierce.png","quiet.png","shards.png","vision.png","avarosa.png","blaze.png","block.png","bolt.png","boot.png","candle.png","crit.png","defend.png","duel.png","eevee.png","ember.png","healing.png","champ.png","chat.png","discovered.png","dislike.png","flag.png","hexigon.png","like.png","pray.png","sword.png"];function L(e){return _({...e},a({className:"flex vhcenter"},x({url:e.data.icon})))}function q(e){const t=i();return U({...e},a({className:"flex vhcenter gutter-tb-.5"},`${t("base_icon")}: `,x({url:e.data.icon})))}function O(e){return I(e,a({className:"flex vhcenter gutter-tb-1",style:{color:"var(--color-black)"}},e.children))}export default e((function(e){const n=i(),[c,b]=(p(V),g(0)),[x,_]=g(1),[U,I]=g(0),[R,S]=g(1),[z,F]=g(1),[T,X]=g(null),[B,D]=g("");u((()=>{T&&(f(T.icon).then(D),b(0),_(1),I(0),S(1),F(1))}),[T]);const[E,G]=g(null),[H,J]=g(!1),K=m((()=>{H||(J(!0),requestAnimationFrame((()=>{N.svgAsPngUri(E,{excludeUnusedCss:!0,width:E.width.baseVal.value,height:E.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),X(null),D(""),J(!1)}),(()=>J(!1)))})))}),[E,H,e.value]),M=m((()=>{X(null),D(""),J(!1)}),[]),[Q,W]=g(!1),Y=m((()=>W(!0))),Z=m((()=>W(!1))),[ee,ae]=g(""),[te,se]=g({x:0,y:0,scale:1}),[oe,le]=g(null),[re,ne]=g(!1);u((()=>{se({x:0,y:0,scale:1}),Z(),ue(!1)}),[ee]);const ce=m((()=>{ae("")}),[]),ie=m((()=>{!re&&Q&&(ne(!0),N.svgAsPngUri(oe,{excludeUnusedCss:!0,width:oe.width.baseVal.value,height:oe.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),ae(""),ne(!1),Z()}),(()=>ne(!1))))}),[oe,re,e.value,Q]),[me,ge,ue]=C(!1),[pe,de,be,fe,ve,he,Ne,xe,ye,ke]=$((e=>{Promise.all([f("/Assets/keyword/poc-frame-overlay.png"),f("/Assets/keyword/poc-frame-overlay-cover.png"),f("/Assets/keyword/poc-frame-overlay-common.png"),f("/Assets/keyword/poc-frame-overlay-rare.png"),f("/Assets/keyword/poc-frame-overlay-epic.png"),f("/Assets/keyword/poc-frame-overlay-legendary.png"),f("/Assets/keyword/poc-common.png"),f("/Assets/keyword/poc-rare.png"),f("/Assets/keyword/poc-epic.png"),f("/Assets/keyword/poc-legendary.png")]).then(e)}),[],[]),[we,Ve]=g("");return a({className:"edit-icon box"},t(a(n("keyword_icon"))),e.value&&e.value.length?a({className:"gutter-trl-.5"},a(n("icons")),e.value.map(((t,s)=>a({className:"flex gutter-b-.5",key:t},a({className:"box gutter-trbl-.5 existing-icon-bg"},a({className:"existing-icon-preview",style:{backgroundImage:`url(${t})`}})),o({className:"gutter-trbl-1",onClick:()=>{const a=[...e.value];a.splice(s,1),e.updateValue(a)}},"X"))))):void 0,T?void 0:a(a({className:"gutter-trl-.5"},n("upload_icon")),v({value:ee,updateValue:ae,moveable:!1}),ee?a(a({className:"flex vhcenter gutter-tb-2"},d(w.Provider,{value:{current:oe,setRef:le}},y({width:256,height:256,loading:re,onTransform:se,...te},a({className:"icon-svg-content "+(me?"poc-icon crop":""),style:{"--scale":te.scale,"--left":te.x,"--top":te.y}},a({className:"scale-adjuster"},h({url:ee,onImageChanged:Y}))),me?r(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${pe})`}}),a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${de})`}}),we?r(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===we&&be||"rare"===we&&fe||"epic"===we&&ve||"champion"===we&&he||""})`}}),a({className:"poc-icon poc-gem",style:{backgroundImage:`url(${"common"===we&&Ne||"rare"===we&&xe||"epic"===we&&ye||"champion"===we&&ke||""})`}})):void 0):void 0))),a({className:"flex gutter-t-.5"},o({className:"box gutter-trbl-1",onClick:ie,[Q?"":"disabled"]:!0},Q?n("use_icon"):a({className:"icon loading"})),a({className:"gutter-r-.5"}),o({className:"gutter-trbl-1",onClick:ce},n("cancel"))),pe?a({className:"flex gutter-t"},o({className:"gutter-trbl-1 grow",onClick:ge},n(me?"turn_poc_off":"turn_poc_on"))):void 0,me?r(j({value:we,updateValue:Ve})):void 0):void 0),ee?void 0:a(T?void 0:a({className:"box gutter-rl-.5 gutter-t-.75"},s(n("or"))),a({className:"gutter-trl-.5"},n("create_icon"),a({className:"gutter-t-.5"},A({options:P.map((e=>({value:e,label:e,icon:`/Assets/custom-icon/${e}`}))),components:{Option:L,SingleValue:q,Placeholder:O},placeholder:n("select_base_icon"),onChange:X,value:T}),B?a(a({className:"flex vhcenter gutter-t-.5"},d(w.Provider,{value:{current:E,setRef:G}},y({width:128,height:128,loading:H},a({className:"custom-icon",style:{backgroundImage:B?`url(${B})`:void 0,filter:`brightness(${R}) sepia(${z}) saturate(${U}) hue-rotate(${c}deg) contrast(${x})`}})))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("saturation"),":"),a({className:"grow gutter-tb"},l({formatLabel:e=>`${k(100*e)}%`,value:U,minValue:0,maxValue:5,step:.01,onChange:I}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("hue_rotation"),":"),a({className:"grow gutter-tb"},l({formatLabel:e=>`${k(e)}deg`,value:c,minValue:0,maxValue:360,step:1,onChange:b}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("brightness"),":"),a({className:"grow gutter-tb"},l({formatLabel:e=>`${k(100*e)}%`,value:R,minValue:0,maxValue:2,step:.01,onChange:S}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("contrast"),":"),a({className:"grow gutter-tb"},l({formatLabel:e=>`${k(100*e)}%`,value:x,minValue:0,maxValue:5,step:.01,onChange:_}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},n("sepia"),":"),a({className:"grow gutter-tb"},l({formatLabel:e=>`${k(100*e)}%`,value:z,minValue:0,maxValue:1,step:.01,onChange:F}))),a({className:"flex gutter-t-.5"},o({className:"box gutter-trbl-1",onClick:K},n("use_icon")),a({className:"gutter-r-.5"}),o({className:"gutter-trbl-1",onClick:M},n("cancel")))):void 0))))}));