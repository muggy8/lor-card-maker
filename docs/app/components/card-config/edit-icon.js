import e,{div as a,label as t,strong as s,button as l,InputRange as o}from"/Utils/elements.js";import r,{components as n}from"/cdn/react-select";import c from"/Utils/use-lang.js";import{useCallback as i,useState as u,useEffect as g,useContext as m,createElement as p}from"/cdn/react";import d from"/Utils/load-css.js";import b from"/Utils/datauri.js";import f from"/Components/card-config/edit-art.js";import v from"/Components/card-template/image-render.js";import h from"/cdn/save-svg-as-png";import{InlineIcon as x}from"/Components/card-template/effect-text.js";import N from"../card-template/svg-wrap.js";import{decimalLimit as V}from"/Components/card-config/edit-shade.js";import{svgRefference as C}from"/Views/card-editor.js";import{Globals as w}from"/Views/index.js";import{openUri as $}from"/Views/card-editor.js";d("/Components/card-config/edit-icon.css");const j=e(r),k=e(n.Option),y=e(n.SingleValue),_=e(n.Placeholder),U=["negate.png","nou.png","october.png","pierce.png","quiet.png","shards.png","vision.png","avarosa.png","blaze.png","block.png","bolt.png","boot.png","candle.png","crit.png","defend.png","duel.png","eevee.png","ember.png","healing.png","champ.png","chat.png","discovered.png","dislike.png","flag.png","hexigon.png","like.png","pray.png","sword.png"];function P(e){return k({...e},a({className:"flex vhcenter"},x({url:e.data.icon})))}function L(e){const t=c();return y({...e},a({className:"flex vhcenter gutter-tb-.5"},`${t("base_icon")}: `,x({url:e.data.icon})))}function A(e){return _(e,a({className:"flex vhcenter gutter-tb-1",style:{color:"var(--color-black)"}},e.children))}export default e((function(e){const r=c(),[n,d]=(m(w),u(0)),[x,$]=u(1),[k,y]=u(0),[_,I]=u(1),[q,O]=u(1),[R,S]=u(null),[z,F]=u("");g((()=>{R&&(b(R.icon).then(F),d(0),$(1),y(0),I(1),O(1))}),[R]);const[T,X]=u(null),[B,D]=u(!1),E=i((()=>{B||(D(!0),requestAnimationFrame((()=>{h.svgAsPngUri(T,{excludeUnusedCss:!0,width:T.width.baseVal.value,height:T.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),S(null),F(""),D(!1)}),(()=>D(!1)))})))}),[T,B,e.value]),G=i((()=>{S(null),F(""),D(!1)}),[]),[H,J]=u(!1),K=i((()=>J(!0))),M=i((()=>J(!1))),[Q,W]=u(""),[Y,Z]=u({x:0,y:0,scale:1}),[ee,ae]=u(null),[te,se]=u(!1);g((()=>{Z({x:0,y:0,scale:1}),M()}),[Q]);const le=i((()=>{W("")}),[]),oe=i((()=>{!te&&H&&(se(!0),h.svgAsPngUri(ee,{excludeUnusedCss:!0,width:ee.width.baseVal.value,height:ee.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),W(""),se(!1),M()}),(()=>se(!1))))}),[ee,te,e.value,H]);return a({className:"edit-icon box"},t(a(r("keyword_icon"))),e.value&&e.value.length?a({className:"gutter-trl-.5"},a(r("icons")),e.value.map(((t,s)=>a({className:"flex gutter-b-.5",key:t},a({className:"box gutter-trbl-.5 existing-icon-bg"},a({className:"existing-icon-preview",style:{backgroundImage:`url(${t})`}})),l({className:"gutter-trbl-1",onClick:()=>{const a=[...e.value];a.splice(s,1),e.updateValue(a)}},"X"))))):void 0,R?void 0:a(a({className:"gutter-trl-.5"},r("upload_icon")),f({value:Q,updateValue:W,moveable:!1}),Q?a(a({className:"flex vhcenter gutter-tb-2"},p(C.Provider,{value:{current:ee,setRef:ae}},N({width:128,height:128,loading:te,onTransform:Z,...Y},a({className:"icon-svg-content",style:{"--scale":Y.scale,"--left":Y.x,"--top":Y.y}},a({className:"scale-adjuster"},v({url:Q,onImageChanged:K})))))),a({className:"flex gutter-t-.5"},l({className:"box gutter-trbl-1",onClick:oe,[H?"":"disabled"]:!0},H?r("use_icon"):a({className:"icon loading"})),a({className:"gutter-r-.5"}),l({className:"gutter-trbl-1",onClick:le},r("cancel")))):void 0),Q?void 0:a(R?void 0:a({className:"box gutter-rl-.5 gutter-t-.75"},s(r("or"))),a({className:"gutter-trl-.5"},r("create_icon"),a({className:"gutter-t-.5"},j({options:U.map((e=>({value:e,label:e,icon:`/Assets/custom-icon/${e}`}))),components:{Option:P,SingleValue:L,Placeholder:A},placeholder:r("select_base_icon"),onChange:S,value:R}),z?a(a({className:"flex vhcenter gutter-t-.5"},p(C.Provider,{value:{current:T,setRef:X}},N({width:128,height:128,loading:B},a({className:"custom-icon",style:{backgroundImage:z?`url(${z})`:void 0,filter:`brightness(${_}) sepia(${q}) saturate(${k}) hue-rotate(${n}deg) contrast(${x})`}})))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},r("saturation"),":"),a({className:"grow gutter-tb"},o({formatLabel:e=>`${V(100*e)}%`,value:k,minValue:0,maxValue:5,step:.01,onChange:y}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},r("hue_rotation"),":"),a({className:"grow gutter-tb"},o({formatLabel:e=>`${V(e)}deg`,value:n,minValue:0,maxValue:360,step:1,onChange:d}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},r("brightness"),":"),a({className:"grow gutter-tb"},o({formatLabel:e=>`${V(100*e)}%`,value:_,minValue:0,maxValue:2,step:.01,onChange:I}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},r("contrast"),":"),a({className:"grow gutter-tb"},o({formatLabel:e=>`${V(100*e)}%`,value:x,minValue:0,maxValue:5,step:.01,onChange:$}))),t({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4"},r("sepia"),":"),a({className:"grow gutter-tb"},o({formatLabel:e=>`${V(100*e)}%`,value:q,minValue:0,maxValue:1,step:.01,onChange:O}))),a({className:"flex gutter-t-.5"},l({className:"box gutter-trbl-1",onClick:E},r("use_icon")),a({className:"gutter-r-.5"}),l({className:"gutter-trbl-1",onClick:G},r("cancel")))):void 0))))}));