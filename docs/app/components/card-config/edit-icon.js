import e,{div as a,label as o,strong as r,button as s,fragment as t,select as c,option as l}from"/Utils/elements.js";import n,{components as m}from"/cdn/react-select";import i from"/Utils/use-lang.js";import{useCallback as p,useState as g,useEffect as u,useContext as d,createElement as v}from"/cdn/react";import f from"/Utils/load-css.js";import y from"/Utils/datauri.js";import b from"/Components/card-config/edit-art.js";import N from"/Components/card-template/image-render.js";import h from"/cdn/save-svg-as-png";import{InlineIcon as x}from"/Components/card-template/effect-text.js";import k from"../card-template/svg-wrap.js";import{decimalLimit as w}from"/Components/card-config/edit-shade.js";import{svgRefference as A}from"/Views/card-editor.js";import{Globals as $}from"/Views/index.js";import C from"/Utils/use-asset-cache.js";import j from"/Components/range-input.js";import I from"./edit-rarity-poc.js";f("/Components/card-config/edit-icon.css");const V=e(n),_=e(m.Option),U=e(m.SingleValue),P=e(m.Placeholder),L=["negate.png","nou.png","october.png","pierce.png","quiet.png","shards.png","vision.png","avarosa.png","blaze.png","block.png","bolt.png","boot.png","candle.png","crit.png","defend.png","duel.png","eevee.png","ember.png","healing.png","champ.png","chat.png","discovered.png","dislike.png","flag.png","hexigon.png","like.png","pray.png","sword.png"],q=["none","power","relic","item"];function O(e){return _({...e},a({className:"flex vhcenter"},x({url:e.data.icon})))}function R(e){const o=i();return U({...e},a({className:"flex vhcenter gutter-tb-.5"},`${o("base_icon")}: `,x({url:e.data.icon})))}function S(e){return P(e,a({className:"flex vhcenter gutter-tb-1",style:{color:"var(--color-black)"}},e.children))}export default e((function(e){const n=i(),[m,f]=(d($),g(0)),[x,_]=g(1.5),[U,P]=g(0),[z,F]=g(.65),[T,X]=g(1),[B,D]=g(null),[E,G]=g("");u((()=>{B&&(y(B.icon).then(G),f(0),_(1.5),P(0),F(.65),X(1))}),[B]);const[H,J]=g(null),[K,M]=g(!1),Q=p((()=>{K||(M(!0),requestAnimationFrame((()=>{h.svgAsPngUri(H,{excludeUnusedCss:!0,width:H.width.baseVal.value,height:H.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),D(null),G(""),M(!1)}),(()=>M(!1)))})))}),[H,K,e.value]),W=p((()=>{D(null),G(""),M(!1)}),[]),[Y,Z]=g(!1),ee=p((()=>Z(!0))),ae=p((()=>Z(!1))),[oe,re]=g(""),[se,te]=g({x:0,y:0,scale:1}),[ce,le]=g(null),[ne,me]=g(!1);u((()=>{te({x:0,y:0,scale:1}),ae(),ue(!1)}),[oe]);const ie=p((()=>{re("")}),[]),pe=p((()=>{!ne&&Y&&(me(!0),h.svgAsPngUri(ce,{excludeUnusedCss:!0,width:ce.width.baseVal.value,height:ce.height.baseVal.value}).then((a=>{e.updateValue([...e.value||[],a]),re(""),me(!1),ae()}),(()=>me(!1))))}),[ce,ne,e.value,Y]),[ge,ue]=g(!1),de=p((e=>{const a=e.target,o=a[a.selectedIndex];"none"===o.value?ue(!1):ue(o.value)}),[]),[ve,fe,ye,be,Ne,he,xe,ke,we,Ae,$e,Ce,je,Ie,Ve,_e,Ue,Pe,Le,qe,Oe,Re,Se,ze]=C((e=>{Promise.all([y("/Assets/keyword/poc-frame-overlay.png"),y("/Assets/keyword/poc-frame-overlay-cover.png"),y("/Assets/keyword/poc-frame-overlay-common.png"),y("/Assets/keyword/poc-frame-overlay-rare.png"),y("/Assets/keyword/poc-frame-overlay-epic.png"),y("/Assets/keyword/poc-frame-overlay-legendary.png"),y("/Assets/keyword/poc-frame-overlay-special.png"),y("/Assets/keyword/poc-common.png"),y("/Assets/keyword/poc-rare.png"),y("/Assets/keyword/poc-epic.png"),y("/Assets/keyword/poc-legendary.png"),y("/Assets/keyword/poc-special.png"),y("/Assets/keyword/poc-relic-frame.png"),y("/Assets/keyword/poc-relic-frame-overlay-common.png"),y("/Assets/keyword/poc-relic-frame-overlay-rare.png"),y("/Assets/keyword/poc-relic-frame-overlay-epic.png"),y("/Assets/keyword/poc-relic-frame-overlay-legendary.png"),y("/Assets/keyword/poc-relic-frame-overlay-special.png"),y("/Assets/keyword/poc-item-frame.png"),y("/Assets/keyword/poc-item-frame-overlay-common.png"),y("/Assets/keyword/poc-item-frame-overlay-rare.png"),y("/Assets/keyword/poc-item-frame-overlay-epic.png"),y("/Assets/keyword/poc-item-frame-overlay-legendary.png"),y("/Assets/keyword/poc-item-frame-overlay-special.png")]).then(e)}),[],[]),[Fe,Te]=g(""),Xe=p((()=>t(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${ve})`}}),a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${fe})`}}),Fe?t(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===Fe&&ye||"rare"===Fe&&be||"epic"===Fe&&Ne||"legendary"===Fe&&he||"special"===Fe&&xe||""})`}}),a({className:`poc-icon poc-gem poc-gem-${Fe}`,style:{backgroundImage:`url(${"common"===Fe&&ke||"rare"===Fe&&we||"epic"===Fe&&Ae||"legendary"===Fe&&$e||"special"===Fe&&Ce||""})`}})):void 0)),[Fe,ve,fe,ye,be,Ne,he,xe,ke,we,Ae,$e,Ce]),Be=p((()=>t(Fe?a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===Fe&&Ie||"rare"===Fe&&Ve||"epic"===Fe&&_e||"legendary"===Fe&&Ue||"special"===Fe&&Pe||""})`}}):void 0,a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${je})`}}),Fe?a({className:`poc-icon poc-gem poc-gem-${Fe} relic`,style:{backgroundImage:`url(${"common"===Fe&&ke||"rare"===Fe&&we||"epic"===Fe&&Ae||"legendary"===Fe&&$e||"special"===Fe&&Ce||""})`}}):void 0)),[Fe,je,Ie,Ve,_e,Ue,Pe,ke,we,Ae,$e,Ce]),De=p((()=>t(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${Le})`}}),Fe?t(a({className:"poc-icon poc-frame",style:{backgroundImage:`url(${"common"===Fe&&qe||"rare"===Fe&&Oe||"epic"===Fe&&Re||"legendary"===Fe&&Se||"special"===Fe&&ze||""})`}}),a({className:`poc-icon poc-gem poc-gem-${Fe} item`,style:{backgroundImage:`url(${"common"===Fe&&ke||"rare"===Fe&&we||"epic"===Fe&&Ae||"legendary"===Fe&&$e||"special"===Fe&&Ce||""})`}})):void 0)),[Fe,Le,qe,Oe,Re,Se,ze,ke,we,Ae,$e,Ce]),Ee=p((()=>{switch(ge){case"power":return"poc-icon crop-power";case"item":return"poc-icon crop-item";case"relic":return"poc-icon crop-relic";default:return""}}),[ge]);return a({className:"edit-icon box"},o(a(n("keyword_icon"))),e.value&&e.value.length?a({className:"gutter-trl-.5"},a(n("icons")),e.value.map(((o,r)=>a({className:"flex gutter-b-.5",key:o},a({className:"box gutter-trbl-.5 existing-icon-bg"},a({className:"existing-icon-preview",style:{backgroundImage:`url(${o})`}})),s({className:"gutter-trbl-1",onClick:()=>{const a=[...e.value];a.splice(r,1),e.updateValue(a)}},"X"))))):void 0,B?void 0:a(a({className:"gutter-trl-.5"},n("upload_icon")),b({value:oe,updateValue:re,moveable:!1}),oe?a(a({className:"flex vhcenter gutter-tb-2"},v(A.Provider,{value:{current:ce,setRef:le}},k({width:256,height:256,loading:ne,onTransform:te,...se},a({className:`icon-svg-content ${Ee()}`,style:{"--scale":se.scale,"--left":se.x,"--top":se.y}},a({className:"scale-adjuster"},N({url:oe,onImageChanged:ee}))),"power"===ge?Xe():void 0,"relic"===ge?Be():void 0,"item"===ge?De():void 0))),a({className:"flex gutter-t-.5"},s({className:"box gutter-trbl-1",onClick:pe,[Y?"":"disabled"]:!0},Y?n("use_icon"):a({className:"icon loading"})),a({className:"gutter-r-.5"}),s({className:"gutter-trbl-1",onClick:ie},n("cancel"))),ve?a({className:"gutter-tb"},o(n("poc_mode")),a({className:"gutter-t-.5 flex"},c({onChange:de,className:"grow gutter-trbl",value:ge||"none"},q.map((e=>l({key:e,value:e},n(e))))))):void 0,ge?t(I({value:Fe,updateValue:Te})):void 0):void 0),oe?void 0:a(B?void 0:a({className:"box gutter-rl-.5 gutter-t-.75"},r(n("or"))),a({className:"gutter-trl-.5"},n("create_icon"),a({className:"gutter-t-.5"},V({options:L.map((e=>({value:e,label:e,icon:`/Assets/custom-icon/${e}`}))),components:{Option:O,SingleValue:R,Placeholder:S},placeholder:n("select_base_icon"),onChange:D,value:B}),E?a(a({className:"flex vhcenter gutter-t-.5"},v(A.Provider,{value:{current:H,setRef:J}},k({width:128,height:128,loading:K},a({className:"custom-icon",style:{backgroundImage:E?`url(${E})`:void 0,filter:`brightness(${z}) sepia(${T}) saturate(${U}) hue-rotate(${m}deg) contrast(${x})`}})))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("saturation"),":"),a({className:"grow gutter-t"},j({formatLabel:e=>`${w(100*e)}%`,value:U,min:0,max:5,step:.01,onChange:P}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("hue_rotation"),":"),a({className:"grow gutter-t"},j({formatLabel:e=>`${w(e)}deg`,value:m,min:0,max:360,step:1,onChange:f}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("brightness"),":"),a({className:"grow gutter-t"},j({formatLabel:e=>`${w(100*e)}%`,value:z,min:0,max:2,step:.01,onChange:F}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("contrast"),":"),a({className:"grow gutter-t"},j({formatLabel:e=>`${w(100*e)}%`,value:x,min:0,max:5,step:.01,onChange:_}))),o({className:"box gutter-trbl-.5 flex-s"},a({className:"box-4 flex vcenter gutter-t"},n("sepia"),":"),a({className:"grow gutter-t"},j({formatLabel:e=>`${w(100*e)}%`,value:T,min:0,max:1,step:.01,onChange:X}))),a({className:"flex gutter-t-.5"},s({className:"box gutter-trbl-1",onClick:Q},n("use_icon")),a({className:"gutter-r-.5"}),s({className:"gutter-trbl-1",onClick:W},n("cancel")))):void 0))))}));