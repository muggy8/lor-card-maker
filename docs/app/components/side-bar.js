import e,{div as t,span as a,label as s,a as o,input as l,nav as n,select as r,option as c,fragment as i}from"/Utils/elements.js";import{useCallback as m,useState as d,useRef as p,useContext as u,useEffect as g}from"/cdn/react";import{Globals as b}from"/Views/index.js";import h from"/Utils/load-css.js";import k,{SUPPORTED_LANGUAGES as y}from"/Utils/use-lang.js";import{getBackup as f,saveCard as v}from"/Utils/service.js";import w from"/Views/batch-export.js";import N from"/Utils/use-toggle.js";import{jsonToBlob as C}from"/Components/export.js";import j from"/Views/batch-delete.js";const x=h("/Components/side-bar.css"),S=["oled","dark","light","flash-bomb"],_=["png","webp","jpeg","json","svg"];export default e((function(){const e=k(),a=u(b),h=!0===a.state.settings.lowSpecsMode;g((()=>{document.body.classList.remove(...document.body.classList),document.body.classList.add(a.state.settings.theme)}),[a.state.settings]);const[x,V]=d(!1),L=m((()=>{V(!x)}),[x]),U=p(),A=m((async()=>{const e=await f(),t=JSON.stringify(e);!async function(e,t){if(window.AndroidNativeInterface){const a=await new Promise((t=>{var a=new FileReader;a.readAsDataURL(e),a.onloadend=function(){t(a.result)}})),s=/data:([^;]+);(([^;]+);)*base64,/,[o,l]=s.exec(a),n=JSON.stringify({image:a.substr(o.length),fileName:t});window.AndroidNativeInterface.postMessage(n)}else{var a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=t,a.click()}}(C(t),"card-data.json")}),[]),[O,F,R]=N(!1),J=m((async e=>{R(!0);const t=await new Promise((t=>{let a=new FileReader,s=e.target.files[0];a.addEventListener("load",(()=>{let e=JSON.parse(a.result);t(e)})),s&&a.readAsText(s)})),a=[{key:"savedChampions1",type:"champion1"},{key:"savedChampions2",type:"champion2"},{key:"savedChampions3",type:"champion3"},{key:"savedFollowers",type:"follower"},{key:"savedKeywords",type:"keyword"},{key:"savedLandmarks",type:"landmark"},{key:"savedSpells",type:"spell"}].map((e=>t[e.key]?t[e.key].map((({id:t,cardData:a})=>(a.id=t,a.type=e.type,"gemless"!==a.rarity&&"none"!==a.rarity||(a.rarity=""),a.dataVersion=2,a))):[])).flat(),s=t.cards?t.cards.filter((e=>2===e.dataVersion)):[];[...a,...s].forEach((e=>{Object.prototype.hasOwnProperty.call(e,"clan")&&(Array.isArray(e.clan)||(e.clan?e.clan=[e.clan]:e.clan=[]))}));const o=[...a,...s];for(let e of o)await v(e.id,e);R(!1),document.location.reload()})),M=m((()=>{a.setView(w),V(!1)}),[a.setView]),E=m((()=>{a.setView(j),console.log("batch delete time"),V(!1)}),[a.setView]);return i(t({className:"side-bar-backdrop "+(x?"open":""),onClick:L}),n({className:"side-bar card-text-universe gutter-rl-3 flex column vhcenter "+(x?"open":"")},t({className:"menu-icon flex vhcenter",onClick:L},t({className:`icon clickable ${h?"":"animated"} ${x?"multiply":"menu"}`})),t({className:"menu-contents gutter-tb-2"},s({className:"menu-option clickable gutter-tb"},t(e("theme")),r({value:a.state.settings.theme||"oled",onChange:e=>a.patchSettings({theme:e.target.value}),className:"select-theme gutter-rl-1 gutter-tb-.5"},S.map((t=>c({key:t,value:t},e(t)))))),s({className:"menu-option clickable gutter-tb"},t(e("language")),r({value:a.state.settings.lang||"oled",onChange:e=>a.patchSettings({lang:e.target.value}),className:"select-theme gutter-rl-1 gutter-tb-.5"},y.map((t=>c({key:t,value:t},e(t)))))),s({className:"menu-option clickable gutter-tb"},t(e("export_format")),r({value:a.state.settings.exportFormat||"png",onChange:e=>a.patchSettings({exportFormat:e.target.value}),className:"select-theme gutter-rl-1 gutter-tb-.5"},_.map((t=>c({key:t,value:t},e(t)))))),t({className:"menu-option clickable gutter-tb",onClick:M},e("batch_export")),t({className:"menu-option clickable gutter-tb",onClick:E},e("bulk_delete")),t({className:"menu-option clickable gutter-tb",onClick:A},e("export_save")),s({className:"menu-option clickable gutter-tb"},O?void 0:e("import_save"),O?void 0:l({className:"hide",accept:"application/json",type:"file",onChange:J}),O?t({className:"icon loading"}):void 0),s({className:"menu-option clickable gutter-tb",onClick:()=>{}},t(e("low_specs_mode")),r({value:a.state.settings.lowSpecsMode||0,onChange:e=>a.patchSettings({lowSpecsMode:!!parseInt(e.target.value)}),className:"select-theme gutter-rl-1 gutter-tb-.5"},c({value:1},e("on")),c({value:0},e("off")))),s({className:"menu-option clickable gutter-tb",onClick:()=>U.current.click()},e("report_bug"),o({ref:U,href:"https://github.com/muggy8/lor-card-maker/issues",className:"hide",target:"_blank"})),s({className:"menu-option clickable gutter-tb",onClick:()=>U.current.click()},e("join_discord"),o({ref:U,href:"https://discord.gg/tKScJa6u6m",className:"hide",target:"_blank"})))))}),x);