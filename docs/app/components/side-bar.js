import e,{div as t,span as a,label as s,a as o,input as i,nav as l,select as c,option as r}from"/Utils/elements.js";import{useCallback as n,useState as m,useRef as d,useContext as p,useEffect as u}from"/cdn/react";import{Globals as y}from"/Views/index.js";import k from"/Utils/load-css.js";import g from"/Utils/use-lang.js";import{getCardList as b,saveCard as f}from"/Utils/service.js";import h from"/Views/batch-export.js";import{usePWAInstall as v}from"/cdn/react-use-pwa-install";import N from"/Utils/use-toggle.js";const w=k("/Components/side-bar.css"),j=["oled","dark","light","flash-bomb"];export default e((function(){const e=g(),k=p(y);u((()=>{document.body.classList.remove(...document.body.classList),document.body.classList.add(k.state.settings.theme)}),[k.state.settings]);const[w,C]=m(!1),x=n((()=>{C(!w)}),[w]),L=d(),U=v(),V=n((async()=>{const e=await b({include:"deck"});e.reverse();!function(e,t,a){var s=document.createElement("a"),o=new Blob([e],{type:a});s.href=URL.createObjectURL(o),s.download=t,s.click()}(JSON.stringify({cards:e}),"card-data.json","application/json")}),[]),[_,S,O]=N(!1),R=n((async e=>{O(!0);const t=await new Promise((t=>{let a=new FileReader,s=e.target.files[0];a.addEventListener("load",(()=>{let e=JSON.parse(a.result);t(e)})),s&&a.readAsText(s)})),a=[...[{key:"savedChampions1",type:"champion1"},{key:"savedChampions2",type:"champion2"},{key:"savedChampions3",type:"champion3"},{key:"savedFollowers",type:"follower"},{key:"savedKeywords",type:"keyword"},{key:"savedLandmarks",type:"landmark"},{key:"savedSpells",type:"spell"}].map((e=>t[e.key]?t[e.key].map((({id:t,cardData:a})=>(a.id=t,a.type=e.type,"gemless"!==a.rarity&&"none"!==a.rarity||(a.rarity=""),a.dataVersion=2,a))):[])).flat(),...t.cards?t.cards.filter((e=>2===e.dataVersion)):[]];for(let e of a)await f(e.id,e);O(!1),document.location.reload()})),E=n((()=>{k.setView(h),C(!1)}),[k.setView]);return l({className:"side-bar card-text-universe gutter-rl-3 flex column vhcenter "+(w?"open":"")},t({className:"menu-icon flex vhcenter",onClick:x},t({className:"icon animate clickable"},a({className:w?"delete":"menu"}))),s({className:"menu-option clickable gutter-tb"},t({className:"flex vhcenter"},e("theme")),c({value:k.state.settings.theme||"oled",onChange:e=>k.patchSettings({theme:e.target.value}),className:"select-theme gutter-rl-1 gutter-tb-.5"},j.map((t=>r({key:t,value:t},e(t)))))),t({className:"menu-option clickable gutter-tb",onClick:E},e("batch_export")),U?t({className:"menu-option clickable gutter-tb",onClick:U},e("install_app")):void 0,t({className:"menu-option clickable gutter-tb",onClick:V},e("export_save")),s({className:"menu-option clickable gutter-tb"},_?void 0:e("import_save"),_?void 0:i({className:"hide",accept:"application/json",type:"file",onChange:R}),_?t({className:"icon"},t({className:"loading"})):void 0),s({className:"menu-option clickable gutter-tb",onClick:()=>L.current.click()},e("report_bug"),o({ref:L,href:"https://github.com/muggy8/lor-card-maker/issues",className:"hide",target:"_blank"})))}),w);