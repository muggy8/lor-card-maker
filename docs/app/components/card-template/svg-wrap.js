import{useContext as r,useRef as t,useEffect as e,useState as n}from"/cdn/react";import c,{svg as a,rect as i,foreignObject as s,div as o}from"/Utils/elements.js";import{svgRefference as l}from"/Views/card-editor.js";import u from"/cdn/gesto";import d from"/Utils/load-css.js";const h=d("/Components/card-template/svg-wrap.css");export default c((function(c){const d=r(l),h=t(),g=t({x:c.x||0,y:c.y||0,scale:c.scale||0}),m=t();m.current=c.onTransform;const[p,f]=n("inherit");return e((()=>{if(!c.onTransform)return;g.current.x=c.x||0,g.current.y=c.y||0,g.current.scale=c.scale||1;const r=h.current;r.addEventListener("wheel",e),f("grab");const t=new u(r,{container:d.current,preventClickEventOnDrag:!0,preventClickEventOnDragStart:!0,pinchOutside:!0,preventDefault:!0}).on("dragStart",(()=>{f("grabbing")})).on("drag",(r=>{g.current.x+=r.deltaX*(1/g.current.scale),g.current.y+=r.deltaY*(1/g.current.scale),m.current({...g.current})})).on("dragEnd",(()=>{f("grab")})).on("pinchStart",(r=>{r.datas.startScale=g.current.scale,f("grabbing")})).on("pinch",(r=>{g.current.scale=r.datas.startScale*r.scale,m.current({...g.current})})).on("pinchEnd",(()=>{f("grab")}));return m.current({...g.current}),function(){r.removeEventListener("wheel",e),t.unset(),f("inherit")};function e(r){r.preventDefault(),g.current.scale=g.current.scale*(1+r.deltaY/1e3),m.current({...g.current})}}),[!!c.onTransform]),a({width:c.width||"680",height:c.height||"1024",xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${c.width||"680"} ${c.height||"1024"}`,ref:r=>{r&&r!==d.current&&d.setRef(r)}},s({width:c.width||"680",height:c.height||"1024",style:{backgroundColor:"rgba(0,0,0,0)"}},c.children,c.loading?o({className:"loading-shade"},o({className:"icon"},o({className:"loading"}))):void 0),i({x:0,y:0,width:c.width||"680",height:c.height||"1024",opacity:0,ref:h,style:{touchAction:"manipulation",cursor:p}}))}),h);