import{useContext as e,useRef as r,useEffect as t,useState as n}from"/cdn/react";import{isSafari as c,isIOS as i}from"/cdn/react-device-detect";import a from"/cdn/gesto";import s,{svg as o,rect as u,foreignObject as l,div as d,fragment as h}from"/Utils/elements.js";import{svgRefference as m}from"/Views/card-editor.js";import g from"/Utils/load-css.js";import f from"/Utils/use-asset-cache.js";const p=g("/Components/card-template/svg-wrap.css");export default s((function(s){const h=e(m),g=r(),p=r({x:s.x||0,y:s.y||0,scale:s.scale||0}),w=r();w.current=s.onTransform;const[v,x]=n("inherit");t((()=>{if(!s.onTransform||!h.current)return;p.current.x=s.x||0,p.current.y=s.y||0,p.current.scale=s.scale||1;const e=g.current;e.addEventListener("wheel",t,{passive:!1}),x("grab");const r=new a(e,{container:h.current,preventClickEventOnDrag:!0,preventClickEventOnDragStart:!0,pinchOutside:!0,preventDefault:!0}).on("dragStart",(()=>{x("grabbing")})).on("drag",(e=>{p.current.x+=e.deltaX*(1/p.current.scale),p.current.y+=e.deltaY*(1/p.current.scale),w.current({...p.current})})).on("dragEnd",(()=>{x("grab")})).on("pinchStart",(e=>{e.datas.startScale=p.current.scale,x("grabbing")})).on("pinch",(e=>{p.current.scale=e.datas.startScale*e.scale,w.current({...p.current})})).on("pinchEnd",(()=>{x("grab")}));return w.current({...p.current}),function(){e.removeEventListener("wheel",t),r.unset(),x("inherit")};function t(e){return e.preventDefault(),e.stopPropagation(),p.current.scale=p.current.scale*(1+e.deltaY/1e3),w.current({...p.current}),!1}}),[!!s.onTransform,h.current]);const b=r(),y=f((e=>{if(c||i)return requestAnimationFrame(r),window.addEventListener("resize",r),function(){window.removeEventListener("resize",r)};function r(){const t=b.current.clientWidth,n=b.current.parentElement.clientWidth;if(!t||!n)return requestAnimationFrame(r);e({"--safari-scale-fix":n/t})}}),[s.loading]);return o({width:s.width||"680",height:s.height||"1024",xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${s.width||"680"} ${s.height||"1024"}`,ref:e=>{e&&e!==h.current&&h.setRef(e)}},l({width:s.width||"680",height:s.height||"1024",style:{backgroundColor:"rgba(0,0,0,0)",...y},ref:b,className:c||i?"fix-safari":""},s.children,s.loading?d({className:"loading-shade"},d({className:"icon loading"})):void 0,d({ref:g,className:"ios-gesture-receiver"})),c||i?void 0:u({x:0,y:0,width:s.width||"680",height:s.height||"1024",opacity:0,ref:g,style:{touchAction:"manipulation",cursor:v}}))}),p);