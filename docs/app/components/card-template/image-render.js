import e,{div as t}from"/Utils/elements.js";import{useEffect as a,useState as i}from"/cdn/react";import n from"/Utils/load-css.js";import o from"/Utils/set-immediate-batch.js";const r=n("/Components/card-template/image-render.css");function s(e=0){return new Promise(e?t=>{setTimeout(t,e)}:e=>{o(e)})}let m={};const h=fetch("/Components/card-template/image-render-worker.js").then((e=>e.text()));function d(e){if(m[e])return m[e];let t;return m[e]=h.then((e=>{const a=`data:text/javascript;base64,${btoa(e)}`;t=new Worker(a)})).then((()=>function(e){return new Promise((t=>{const a=new Image;a.addEventListener("load",(()=>{t({width:a.width,height:a.height,image:a})})),a.src=e}))}(e))).then((async a=>{const i=await fetch(e).then((e=>e.blob())),n=await createImageBitmap(i),o=await new Promise(((e,i)=>{t.onmessage=a=>{t.terminate(),e(a.data)},t.onerror=o=>{t.terminate(),console.warn(o),async function({image:e,width:t,height:a}){const i=document.createElement("canvas");i.width=2*t,i.height=2*a;const n=i.getContext("2d");return void 0!==n.mozImageSmoothingEnabled&&(n.mozImageSmoothingEnabled=!1),void 0!==n.oImageSmoothingEnabled&&(n.oImageSmoothingEnabled=!1),void 0!==CanvasRenderingContext2D.webkitImageSmoothingEnabled&&(CanvasRenderingContext2D.webkitImageSmoothingEnabled=!1),void 0!==n.imageSmoothingEnabled&&(n.imageSmoothingEnabled=!1),n.clearRect(0,0,i.width,i.height),await s(),n.drawImage(e,0,0,t,a,0,0,t,a),await s(50),n.scale(-1,1),await s(),n.drawImage(e,0,0,t,a,-i.width,0,t,a),await s(),n.setTransform(1,0,0,1,0,0),await s(50),n.scale(1,-1),await s(),n.drawImage(e,0,0,t,a,0,-i.height,t,a),await s(),n.setTransform(1,0,0,1,0,0),await s(50),n.scale(-1,-1),await s(),n.drawImage(e,0,0,t,a,-i.width,-i.height,t,a),await s(),n.setTransform(1,0,0,1,0,0),await s(),new Promise((e=>{i.toBlob(e)}))}({width:a.width,height:a.height,image:n}).then(e,i)},t.postMessage({width:a.width,height:a.height,image:n})})),r=await function(e){return new Promise(((t,a)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.readAsDataURL(e)}))}(o);return{width:a.width,height:a.height,b64:r}}))}export default e((function(e){const{url:n}=e,[o,r]=i({});return a((()=>{n&&d(n).then(r)}),[n]),t({className:"processed-art "+(n&&!o.b64?"loading":""),style:{"--width":o.width||0,"--height":o.height||0,backgroundImage:o.b64?`url(${o.b64})`:""}},n&&!o.b64?t({className:"icon"},t({className:"loading"})):void 0)}),r);