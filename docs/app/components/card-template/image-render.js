import factory,{div}from"/Utils/elements.js";import{useEffect,useState}from"/cdn/react";import loadCss from"/Utils/load-css.js";const cssLoaded=loadCss("/Components/card-template/image-render.css");function getDimensions(e){return new Promise(t=>{const a=new Image;a.addEventListener("load",()=>{t({width:a.width,height:a.height,image:a})}),a.src=e})}let replicationCache={};async function getReplicateImage(e){if(replicationCache[e])return replicationCache[e];const{width:t,height:a,image:i}=await getDimensions(e),n=document.createElement("canvas");n.width=2*t,n.height=2*a;const o=n.getContext("2d");return void 0!==o.mozImageSmoothingEnabled&&(o.mozImageSmoothingEnabled=!1),void 0!==o.oImageSmoothingEnabled&&(o.oImageSmoothingEnabled=!1),void 0!==CanvasRenderingContext2D.webkitImageSmoothingEnabled&&(CanvasRenderingContext2D.webkitImageSmoothingEnabled=!1),void 0!==o.imageSmoothingEnabled&&(o.imageSmoothingEnabled=!1),o.clearRect(0,0,n.width,n.height),o.drawImage(i,0,0,t,a,0,0,t,a),o.scale(-1,1),o.drawImage(i,0,0,t,a,-n.width,0,t,a),o.setTransform(1,0,0,1,0,0),o.scale(1,-1),o.drawImage(i,0,0,t,a,0,-n.height,t,a),o.setTransform(1,0,0,1,0,0),o.scale(-1,-1),o.drawImage(i,0,0,t,a,-n.width,-n.height,t,a),o.setTransform(1,0,0,1,0,0),replicationCache[e]={width:n.width,height:n.height,b64:n.toDataURL()}}function ArtComponent(e){const{url:t}=e,[a,i]=useState({});return useEffect(()=>{t&&getReplicateImage(t).then(i)},[t]),div({className:"processed-art",style:{"--width":a.width||0,"--height":a.height||0,backgroundImage:a.b64?`url(${a.b64})`:""}})}export default factory(ArtComponent,cssLoaded);