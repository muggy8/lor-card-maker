import e,{div as t}from"/Utils/elements.js";import a from"/Utils/load-css.js";import n from"/Utils/set-immediate-batch.js";import i from"/Utils/use-asset-cache.js";import{useEffect as o}from"/cdn/react";const r=a("/Components/card-template/image-render.css");function m(e=0){return new Promise(e?t=>{setTimeout(t,e)}:e=>{n(e)})}let s={};const h=fetch("/Components/card-template/image-render-worker.js").then((e=>e.text()));function d(e){if(s[e])return s[e];let t;return s[e]=h.then((e=>{const a=`data:text/javascript;base64,${btoa(e)}`;t=new Worker(a)})).then((()=>function(e){return new Promise((t=>{const a=new Image;a.addEventListener("load",(()=>{t({width:a.width,height:a.height,image:a})})),a.src=e}))}(e))).then((async a=>{const n=await fetch(e).then((e=>e.blob())),i=await createImageBitmap(n),o=await new Promise(((e,n)=>{t.onmessage=a=>{t.terminate(),e(a.data)},t.onerror=o=>{t.terminate(),console.warn(o),async function({image:e,width:t,height:a}){const n=document.createElement("canvas");n.width=2*t,n.height=2*a;const i=n.getContext("2d");return void 0!==i.mozImageSmoothingEnabled&&(i.mozImageSmoothingEnabled=!1),void 0!==i.oImageSmoothingEnabled&&(i.oImageSmoothingEnabled=!1),void 0!==CanvasRenderingContext2D.webkitImageSmoothingEnabled&&(CanvasRenderingContext2D.webkitImageSmoothingEnabled=!1),void 0!==i.imageSmoothingEnabled&&(i.imageSmoothingEnabled=!1),i.clearRect(0,0,n.width,n.height),await m(),i.drawImage(e,0,0,t,a,0,0,t,a),await m(50),i.scale(-1,1),await m(),i.drawImage(e,0,0,t,a,-n.width,0,t,a),await m(),i.setTransform(1,0,0,1,0,0),await m(50),i.scale(1,-1),await m(),i.drawImage(e,0,0,t,a,0,-n.height,t,a),await m(),i.setTransform(1,0,0,1,0,0),await m(50),i.scale(-1,-1),await m(),i.drawImage(e,0,0,t,a,-n.width,-n.height,t,a),await m(),i.setTransform(1,0,0,1,0,0),await m(),new Promise((e=>{n.toBlob(e)}))}({width:a.width,height:a.height,image:i}).then(e,n)},t.postMessage({width:a.width,height:a.height,image:i})})),r=await function(e){return new Promise(((t,a)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(e)}))}(o);return{width:a.width,height:a.height,b64:r}}))}export default e((function(e){const{url:a}=e,n=i((e=>{a&&d(a).then(e)}),[a],{});return o((()=>{n.b64&&e.onImageChanged&&e.onImageChanged()}),[e.onImageChanged,n]),t({className:"processed-art "+(a&&!n.b64?"loading":""),style:{"--width":n.width||0,"--height":n.height||0,backgroundImage:n.b64?`url(${n.b64})`:""}},a&&!n.b64?t({className:"icon loading"}):void 0)}),r);