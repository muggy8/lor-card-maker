import e,{div as t}from"/Utils/elements.js";import a from"/Utils/load-css.js";import i from"/Utils/set-immediate-batch.js";import n from"/Utils/use-asset-cache.js";const o=a("/Components/card-template/image-render.css");function r(e=0){return new Promise(e?t=>{setTimeout(t,e)}:e=>{i(e)})}let s={};const h=fetch("/Components/card-template/image-render-worker.js").then((e=>e.text()));function m(e){if(s[e])return s[e];let t;return s[e]=h.then((e=>{const a=`data:text/javascript;base64,${btoa(e)}`;t=new Worker(a)})).then((()=>function(e){return new Promise((t=>{const a=new Image;a.addEventListener("load",(()=>{t({width:a.width,height:a.height,image:a})})),a.src=e}))}(e))).then((async a=>{const i=await fetch(e).then((e=>e.blob())),n=await createImageBitmap(i),o=await new Promise(((e,i)=>{t.onmessage=a=>{t.terminate(),e(a.data)},t.onerror=o=>{t.terminate(),console.warn(o),async function({image:e,width:t,height:a}){const i=document.createElement("canvas");i.width=2*t,i.height=2*a;const n=i.getContext("2d");return void 0!==n.mozImageSmoothingEnabled&&(n.mozImageSmoothingEnabled=!1),void 0!==n.oImageSmoothingEnabled&&(n.oImageSmoothingEnabled=!1),void 0!==CanvasRenderingContext2D.webkitImageSmoothingEnabled&&(CanvasRenderingContext2D.webkitImageSmoothingEnabled=!1),void 0!==n.imageSmoothingEnabled&&(n.imageSmoothingEnabled=!1),n.clearRect(0,0,i.width,i.height),await r(),n.drawImage(e,0,0,t,a,0,0,t,a),await r(50),n.scale(-1,1),await r(),n.drawImage(e,0,0,t,a,-i.width,0,t,a),await r(),n.setTransform(1,0,0,1,0,0),await r(50),n.scale(1,-1),await r(),n.drawImage(e,0,0,t,a,0,-i.height,t,a),await r(),n.setTransform(1,0,0,1,0,0),await r(50),n.scale(-1,-1),await r(),n.drawImage(e,0,0,t,a,-i.width,-i.height,t,a),await r(),n.setTransform(1,0,0,1,0,0),await r(),new Promise((e=>{i.toBlob(e)}))}({width:a.width,height:a.height,image:n}).then(e,i)},t.postMessage({width:a.width,height:a.height,image:n})})),s=await function(e){return new Promise(((t,a)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.readAsDataURL(e)}))}(o);return{width:a.width,height:a.height,b64:s}}))}export default e((function(e){const{url:a}=e,i=n((e=>{a&&m(a).then(e)}),[a],{});return t({className:"processed-art "+(a&&!i.b64?"loading":""),style:{"--width":i.width||0,"--height":i.height||0,backgroundImage:i.b64?`url(${i.b64})`:""}},a&&!i.b64?t({className:"icon loading"}):void 0)}),o);