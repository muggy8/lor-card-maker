import e,{div as t,span as r}from"/Utils/elements.js";import{keywords as n}from"/Components/card-template/keyword-renderer.js";import o,{useRef as s,useLayoutEffect as l,useState as i,useEffect as c}from"/cdn/react";import a from"/Utils/set-immediate-batch.js";import p from"/Utils/load-css.js";import f from"/Utils/datauri.js";import u from"/Utils/use-debounce-effect.js";const g=p("/Components/card-template/effect-text.css"),m=Object.keys(n).filter((e=>n[e].length));export const effectTextSize=24;const d=({clientWidth:e,clientHeight:t,scrollWidth:r,scrollHeight:n})=>r>e||n>t;function h(e,t){return(e+t)/2}function y(){return new Promise((e=>a(e)))}const b=new Map;export async function scaleFontSize(e,t=36,r=24){if(!e)return;let n=window.getComputedStyle(e).getPropertyValue("font-size");if(n=parseFloat(n),n==t&&!d(e))return;const o=b.get(e);if(o)return o;const s=new Promise((o=>{(async()=>{let s=t,l=r,i=n;for(;s-l>.5;){e.style.fontSize=`${i+.5}px`,await y();const t=d(e);e.style.fontSize=`${i}px`,await y();const r=d(e);if(!r&&t)return o();r?(s=i,i=h(s,l)):(l=i,i=h(s,l))}o()})()}));return b.set(e,s.then((()=>{b.delete(e)}))),b.get(e)}function w(s,l,i){let c=[s];m.forEach((e=>{const t=`<${e}/>`,r=n[e];c=c.map((e=>{if("string"!=typeof e)return e;let n=e.split(t);if(1===n.length)return n[0];for(let e=n.length-1;e;e--)n.splice(e,0,r.map((t=>InlineIcon({key:t+e,pngName:t}))));return n})).flat()})),l.forEach((e=>{e&&(c=c.map((t=>{if("string"!=typeof t)return t;let n=t.split(e);if(1===n.length)return n[0];for(let t=n.length-1;t;t--)n.splice(t,0,r({className:"blue-word"},e));return n})).flat())})),i.forEach((e=>{e&&(c=c.map((t=>{if("string"!=typeof t)return t;let n=t.split(e);if(1===n.length)return n[0];for(let t=n.length-1;t;t--)n.splice(t,0,r({className:"orange-word"},e));return n})).flat())})),c=c.map((e=>{if("string"!=typeof e)return e;let r=e.split(/\n+/g);if(1===r.length)return r[0];for(let e=r.length-1;e;e--)r.splice(e,0,t());return r})).flat(),c=c.filter((e=>!!e));for(let t=0;t<c.length;t++){const r=c[t];if("string"==typeof r)continue;if(!o.isValidElement(r))continue;if(!r.props.pngName)continue;const n={},s=[];Object.keys(r.props).forEach((e=>{n[e]=r.props[e]})),r.props.children&&!Array.isArray(r.props.children)&&s.push(r.props.children);let l=c[t+1];for(;l;)c.splice(t+1,1),s.push(l),l="string"!=typeof l||l.trim()?o.isValidElement(l)&&l.props.pngName?c[t+1]:void 0:c[t+1];c.splice(t,1,Function.apply.call(InlineIcon,e,[n,...s]))}return c}export const InlineIcon=e((function(e){const[t,n]=i("");return c((()=>{f(`/Assets/keyword/${e.pngName}`).then(n)}),[e.pngName]),r({className:"inline-icon",style:{"--icon-image":t?`url(${t})`:"none"}},e.children)}));export default e((function(r){let n=r.effectText,o=r.levelText;if(n&&"string"!=typeof n||o&&"string"!=typeof o)throw new Error("Only strings accepted");const[s,l]=i([]);u((()=>{let e=r.blueWords?[...r.blueWords]:[],t=r.orangeWords?[...r.orangeWords]:[];e.sort(((e,t)=>t.length-e.length)),t.sort(((e,t)=>t.length-e.length));const o=w(n,e,t);l(o)}),200,[n,r.blueWords,r.orangeWords]);const[a,p]=i([]);u((()=>{let e=r.blueWords?[...r.blueWords]:[],t=r.orangeWords?[...r.orangeWords]:[];e.sort(((e,t)=>t.length-e.length)),t.sort(((e,t)=>t.length-e.length));const n=w(o,e,t);p(n)}),200,[o,r.blueWords,r.orangeWords]);const[g,m]=i("");c((()=>{f("/Assets/champion/levelupbar.png").then(m)}));const d=t.apply(e,[{className:`effect-text ${r.className||""}`},...s]),h=t.apply(e,[{className:`effect-text level-color ${r.className||""}`},...a]);return n||o?t({className:"card-effects-wrapper"},n?d:void 0,o?t({className:"level-bar",style:{backgroundImage:g?`url(${g||""})`:"none"}}):void 0,o?h:void 0):null}),g);