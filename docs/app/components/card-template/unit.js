import t,{div as e}from"/Utils/elements.js";import{Component as s,createRef as r}from"/cdn/react";import{Globals as i}from"/Views/index.js";import a from"/Components/card-template/keyword-renderer.js";import o from"/Components/card-template/image-render.js";import n,{scaleFontSize as p}from"/Components/card-template/effect-text.js";import h from"/Utils/load-css.js";import c from"/Components/card-template/svg-wrap.js";import l from"/cdn/fitty";import m from"/Utils/datauri.js";import{defaultShade as f}from"/Views/list.js";import d from"/Utils/debounce-function.js";const g=h("/Components/card-template/unit.css");export class UnitRendererComponent extends s{clipPathPolygon=[[25,50],[655,50],[655,950],[340,965],[25,950]];state={};cardFrame="/Assets/champion/frame1.png";clanFrame="/Assets/champion/typing.png";regionPosition="champion";static get contextType(){return i}constructor(t){super(t),this.clanRef=r(),this.costRef=r(),this.powerRef=r(),this.healthRef=r(),this.nameRef=r(),this.cardTextWrapperRef=r(),this.fitClan=d((()=>this.clanRef.current&&p(this.clanRef.current,40,16))),this.fitName=d((()=>this.nameRef.current&&p(this.nameRef.current,70,16))),this.fitCost=d((()=>{this.costRef.current&&(this.costFitty?this.costFitty.fit():this.costFitty=l(this.costRef.current,{multiLine:!1,maxSize:90}))})),this.fitPower=d((()=>{this.powerRef.current&&(this.powerFitty?this.powerFitty.fit():this.powerFitty=l(this.powerRef.current,{multiLine:!1,maxSize:70}))})),this.fitHealth=d((()=>{this.healthRef.current&&(this.healthFitty?this.healthFitty.fit():this.healthFitty=l(this.healthRef.current,{multiLine:!1,maxSize:70}))})),this.scaleText=d((()=>this.cardTextWrapperRef.current&&p(this.cardTextWrapperRef.current)))}getRegionFrameUrl(){let t=this.props.faction.length;return t>3&&(t=3),`/Assets/champion/lvl1regionbox${t}.png`}componentDidMount(){const{fitClan:t,fitCost:e,fitPower:s,fitHealth:r,fitName:i}=this;if(t(),e(),s(),r(),i(),this.fetchUrlAsUriAndStoreInState("/Assets/champion/backdrop.png","backdropUri"),this.fetchUrlAsUriAndStoreInState(this.cardFrame,"frameUri"),this.fetchUrlAsUriAndStoreInState(this.clanFrame,"clanFrameUri"),this.props.rarity&&"gemless"!==this.props.rarity&&this.fetchUrlAsUriAndStoreInState(`/Assets/shared/gem${this.props.rarity}.png`,"rarityUri"),this.props.faction&&this.props.faction.length){const t=this.props.faction.map((t=>m(`/Assets/region/${t}.png`)));Promise.all(t).then((t=>{this.setState((e=>({...e,factionUri:t})))})),this.fetchUrlAsUriAndStoreInState(this.getRegionFrameUrl(),"regionFrameUri")}}fetchUrlAsUriAndStoreInState(t,e){m(t).then((t=>{this.setState((s=>({...s,[e]:t})))}))}componentDidUpdate(t,e){const{clan:s,cost:r,power:i,health:a,name:o,effectText:n,lvup:p,keywords:h}=this.props,{fitClan:c,fitCost:l,fitPower:f,fitHealth:d,fitName:g,scaleText:y}=this,u=!!this.state.frameUri!=!!e.frameUri,U=!!t.name!==o||!(!t.keywords||!t.keywords.length)!=!(!h||!h.length)||t.effectText!==n||t.lvup!==p;if((t.clan!==s||u)&&c(),(t.cost!==r||u)&&l(),(t.power!==i||u)&&f(),(t.health!==a||u)&&d(),(t.name!==o||u)&&g(),(U||u)&&y(),t.rarity!==this.props.rarity&&"gemless"!==this.props.rarity&&"none"!==this.props.rarity&&this.fetchUrlAsUriAndStoreInState(`/Assets/shared/gem${this.props.rarity}.png`,"rarityUri"),this.props.faction&&this.props.faction.length&&t.faction!==this.props.faction){const t=this.props.faction.map((t=>m(`/Assets/region/${t}.png`)));Promise.all(t).then((t=>{this.setState((e=>({...e,factionUri:t})))})),this.fetchUrlAsUriAndStoreInState(this.getRegionFrameUrl(),"regionFrameUri")}}render(){const t=this.props.shade||f,[s,r]=t.gradientLocation;return c({loading:!this.state.frameUri||this.props.loading,onTransform:this.props.updateTransform,...this.props.transform||{x:0,y:0,scale:1}},this.state.frameUri?e({style:{"--background-image":this.context.state.defaultBg?`url(${this.state.backdropUri||""})`:"none","--scale":this.props.transform?this.props.transform.scale:1,"--left":this.props.transform?this.props.transform.x:0,"--top":this.props.transform?this.props.transform.y:0,"--blur":`${t.blur}px`,"--darkness":t.darkness,"--transparent-percent":s+"%","--solid-percent":r+"%"},className:`unit ${this.regionPosition}`,id:this.props.id},e({className:"art",style:{clipPath:`polygon(${this.clipPathPolygon.map((t=>t.map((t=>t+"px")).join(" "))).join(",")})`}},e({className:"scale-adjuster"},o({url:this.props.art}))),e({className:"art blur",style:{clipPath:`polygon(${this.clipPathPolygon.map((t=>t.map((t=>t+"px")).join(" "))).join(",")})`}},e({className:"scale-adjuster"},o({url:this.props.art}))),e({className:"frame",style:{backgroundImage:this.state.frameUri?`url(${this.state.frameUri||""})`:"none"}}),e({className:"card-text-wrapper",ref:this.cardTextWrapperRef},this.props.name?e({className:"name fitty-wrap card-text-bold",ref:this.nameRef},this.props.name):void 0,this.props.keywords&&this.props.keywords.length?e({className:"keyword-container card-text-bold"},this.props.keywords.map((t=>a({key:t,name:t,size:this.props.keywords.length>1?"small":"large"})))):void 0,n({blueWords:this.props.blueWords,orangeWords:this.props.orangeWords,className:"effect-container card-text-universe",effectText:this.props.effect,levelText:this.props.lvup})),e({className:"cost fitty-nowrap card-text-bold",ref:this.costRef},this.props.mana),this.props.faction&&this.props.faction.length?e({className:"region-frame",style:{backgroundImage:this.state.regionFrameUri?`url(${this.state.regionFrameUri||""})`:"none"}},this.state.factionUri?this.state.factionUri.map((t=>e({key:t,className:"region-icon",style:{backgroundImage:`url(${t})`}}))):null):void 0,this.props.clan?e({className:"clan",style:{backgroundImage:this.state.clanFrameUri?`url(${this.state.clanFrameUri||""})`:"none"}},e({ref:this.clanRef,className:"card-text-universe-condensed text-area fitty-nowrap"},this.props.clan)):void 0,void 0!==this.props.power?e({className:"power fitty-nowrap card-text-bold",ref:this.powerRef},this.props.power):void 0,void 0!==this.props.health?e({className:"health fitty-nowrap card-text-bold",ref:this.healthRef},this.props.health):void 0,this.props.rarity&&"gemless"!==this.props.rarity&&"none"!==this.props.rarity?e({className:"rarity "+this.props.rarity,style:{backgroundImage:this.state.rarityUri?`url(${this.state.rarityUri||""})`:"none"}}):void 0):void 0)}}export default t(UnitRendererComponent,g);