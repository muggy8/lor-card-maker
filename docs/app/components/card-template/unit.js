import t,{div as s}from"/Utils/elements.js";import{Component as e,createRef as r}from"/cdn/react";import{Globals as i}from"/Views/index.js";import a from"/Components/card-template/keyword-renderer.js";import o from"/Components/card-template/image-render.js";import n,{scaleFontSize as p}from"/Components/card-template/effect-text.js";import h from"/Utils/load-css.js";import l from"/Components/card-template/svg-wrap.js";import c from"/cdn/fitty";import m from"/Utils/datauri.js";import{defaultShade as f}from"/Views/list.js";import d from"/Utils/debounce-function.js";const g=h("/Components/card-template/unit.css");export class UnitRendererComponent extends e{clipPathPolygon=[[25,50],[655,50],[655,950],[340,965],[25,950]];state={};cardFrame="/Assets/champion/frame1.png";clanFrame="/Assets/champion/typing.png";regionPosition="champion";static get contextType(){return i}constructor(t){super(t),this.clanRef=r(),this.costRef=r(),this.powerRef=r(),this.healthRef=r(),this.nameRef=r(),this.fitClan=d((()=>this.clanRef.current&&p(this.clanRef.current,40,16))),this.fitName=d((()=>this.nameRef.current&&p(this.nameRef.current,70,16))),this.fitCost=d((()=>{this.costRef.current&&(this.costFitty?this.costFitty.fit():this.costFitty=c(this.costRef.current,{multiLine:!1,maxSize:90}))})),this.fitPower=d((()=>{this.powerRef.current&&(this.powerFitty?this.powerFitty.fit():this.powerFitty=c(this.powerRef.current,{multiLine:!1,maxSize:70}))})),this.fitHealth=d((()=>{this.healthRef.current&&(this.healthFitty?this.healthFitty.fit():this.healthFitty=c(this.healthRef.current,{multiLine:!1,maxSize:70}))}))}getRegionFrameUrl(){let t=this.props.faction.length;return t>3&&(t=3),`/Assets/champion/lvl1regionbox${t}.png`}componentDidMount(){const{fitClan:t,fitCost:s,fitPower:e,fitHealth:r,fitName:i}=this;if(t(),s(),e(),r(),i(),this.fetchUrlAsUriAndStoreInState("/Assets/champion/backdrop.png","backdropUri"),this.fetchUrlAsUriAndStoreInState(this.cardFrame,"frameUri"),this.fetchUrlAsUriAndStoreInState(this.clanFrame,"clanFrameUri"),this.fetchUrlAsUriAndStoreInState("/Assets/champion/levelupbar.png","levelupBarUri"),this.props.rarity&&"gemless"!==this.props.rarity&&this.fetchUrlAsUriAndStoreInState(`/Assets/shared/gem${this.props.rarity}.png`,"rarityUri"),this.props.faction&&this.props.faction.length){const t=this.props.faction.map((t=>m(`/Assets/region/${t}.png`)));Promise.all(t).then((t=>{this.setState((s=>({...s,factionUri:t})))})),this.fetchUrlAsUriAndStoreInState(this.getRegionFrameUrl(),"regionFrameUri")}}fetchUrlAsUriAndStoreInState(t,s){m(t).then((t=>{this.setState((e=>({...e,[s]:t})))}))}componentDidUpdate(t,s){const{clan:e,cost:r,power:i,health:a,name:o}=this.props,{fitClan:n,fitCost:p,fitPower:h,fitHealth:l,fitName:c}=this,f=!!this.state.frameUri!=!!s.frameUri;if((t.clan!==e||f)&&n(),(t.cost!==r||f)&&p(),(t.power!==i||f)&&h(),(t.health!==a||f)&&l(),(t.name!==o||f)&&c(),t.rarity!==this.props.rarity&&"gemless"!==this.props.rarity&&"none"!==this.props.rarity&&this.fetchUrlAsUriAndStoreInState(`/Assets/shared/gem${this.props.rarity}.png`,"rarityUri"),this.props.faction&&this.props.faction.length&&t.faction!==this.props.faction){const t=this.props.faction.map((t=>m(`/Assets/region/${t}.png`)));Promise.all(t).then((t=>{this.setState((s=>({...s,factionUri:t})))})),this.fetchUrlAsUriAndStoreInState(this.getRegionFrameUrl(),"regionFrameUri")}}render(){const t=this.props.shade||f,[e,r]=t.gradientLocation;return l({loading:!this.state.frameUri||this.props.loading,onTransform:this.props.updateTransform,...this.props.transform||{x:0,y:0,scale:1}},this.state.frameUri?s({style:{"--background-image":this.context.state.defaultBg?`url(${this.state.backdropUri||""})`:"none","--scale":this.props.transform?this.props.transform.scale:1,"--left":this.props.transform?this.props.transform.x:0,"--top":this.props.transform?this.props.transform.y:0,"--blur":`${t.blur}px`,"--darkness":t.darkness,"--transparent-percent":e+"%","--solid-percent":r+"%"},className:`unit ${this.regionPosition}`,id:this.props.id},s({className:"art",style:{clipPath:`polygon(${this.clipPathPolygon.map((t=>t.map((t=>t+"px")).join(" "))).join(",")})`}},s({className:"scale-adjuster"},o({url:this.props.art}))),s({className:"art blur",style:{clipPath:`polygon(${this.clipPathPolygon.map((t=>t.map((t=>t+"px")).join(" "))).join(",")})`}},s({className:"scale-adjuster"},o({url:this.props.art}))),s({className:"card-text-wrapper"},this.props.name?s({className:"name fitty-wrap card-text-bold",ref:this.nameRef},this.props.name):void 0,this.props.keywords&&this.props.keywords.length?s({className:"keyword-container card-text-bold"},this.props.keywords.map((t=>a({key:t,name:t,size:this.props.keywords.length>1?"small":"large"})))):void 0,this.props.effect?n({blueWords:this.props.blueWords,orangeWords:this.props.orangeWords,className:"effect-container card-text-universe"},this.props.effect):void 0,this.props.lvup?s({className:"level-bar",style:{backgroundImage:this.state.levelupBarUri?`url(${this.state.levelupBarUri||""})`:"none"}}):void 0,this.props.lvup?n({blueWords:this.props.blueWords,orangeWords:this.props.orangeWords,className:"level-up-container card-text-universe"},this.props.lvup):void 0),s({className:"frame",style:{backgroundImage:this.state.frameUri?`url(${this.state.frameUri||""})`:"none"}}),s({className:"cost fitty-nowrap card-text-bold",ref:this.costRef},this.props.mana),this.props.faction&&this.props.faction.length?s({className:"region-frame",style:{backgroundImage:this.state.regionFrameUri?`url(${this.state.regionFrameUri||""})`:"none"}},this.state.factionUri?this.state.factionUri.map((t=>s({key:t,className:"region-icon",style:{backgroundImage:`url(${t})`}}))):null):void 0,this.props.clan?s({className:"clan",style:{backgroundImage:this.state.clanFrameUri?`url(${this.state.clanFrameUri||""})`:"none"}},s({ref:this.clanRef,className:"card-text-universe-condensed text-area fitty-nowrap"},this.props.clan)):void 0,void 0!==this.props.power?s({className:"power fitty-nowrap card-text-bold",ref:this.powerRef},this.props.power):void 0,void 0!==this.props.health?s({className:"health fitty-nowrap card-text-bold",ref:this.healthRef},this.props.health):void 0,this.props.rarity&&"gemless"!==this.props.rarity&&"none"!==this.props.rarity?s({className:"rarity "+this.props.rarity,style:{backgroundImage:this.state.rarityUri?`url(${this.state.rarityUri||""})`:"none"}}):void 0):void 0)}}export default t(UnitRendererComponent,g);