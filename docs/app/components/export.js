import e from"/cdn/save-svg-as-png";import{openUri as t}from"/Views/card-editor.js";export default async function(a,n,s){const o=n.width.baseVal.value,r=n.height.baseVal.value;if("json"===s.state.settings.exportFormat){const e=stringToBlob(JSON.stringify(a,null,"\t")),n=await new Promise((t=>{var a=new FileReader;a.readAsDataURL(e),a.onloadend=function(){t(a.result)}}));return t(n,`${(a.fileName||a.name||"export").toUpperCase()}.json`)}if("svg"===s.state.settings.exportFormat){const s=await e.svgAsDataUri(n,{excludeUnusedCss:!0,width:o,height:r});return t(s,`${(a.fileName||a.name||"export").toUpperCase()}.svg`)}{const p=await e.svgAsPngUri(n,{excludeUnusedCss:!0,width:o,height:r});if(!s.state.settings.exportFormat||"png"===s.state.settings.exportFormat)return t(p,`${(a.fileName||a.name||"export").toUpperCase()}.png`);const l=new OffscreenCanvas(o,r),g=l.getContext("2d"),c=await new Promise((e=>{const t=new Image(o,r);t.onload=()=>e(t),t.src=p}));g.drawImage(c,0,0,o,r);const d=await l.convertToBlob({type:`image/${s.state.settings.exportFormat}`,quality:.8});var i=new FileReader;i.readAsDataURL(d),i.onloadend=function(){var e=i.result;return t(e,`${(a.fileName||a.name||"export").toUpperCase()}.${s.state.settings.exportFormat}`)}}}export function stringToBlob(e){const t=(new TextEncoder).encode(e);return new Blob([t],{type:"application/json;charset=utf-8"})}