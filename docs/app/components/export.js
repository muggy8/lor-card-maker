import t from"/cdn/save-svg-as-png";import{openUri as e}from"/Views/card-editor.js";export default async function(a,n,s){const o=n.width.baseVal.value,r=n.height.baseVal.value;if("json"===s.state.settings.exportFormat){const t=stringToBlob(JSON.stringify(a,null,"\t")),n=await new Promise((e=>{var a=new FileReader;a.readAsDataURL(t),a.onloadend=function(){e(a.result)}}));return e(n,`${(a.name||"export").toUpperCase()}.json`)}if("svg"===s.state.settings.exportFormat){const s=await t.svgAsDataUri(n,{excludeUnusedCss:!0,width:o,height:r});return e(s,`${(a.name||"export").toUpperCase()}.svg`)}{const p=await t.svgAsPngUri(n,{excludeUnusedCss:!0,width:o,height:r});if(!s.state.settings.exportFormat||"png"===s.state.settings.exportFormat)return e(p,`${(a.name||"export").toUpperCase()}.png`);const g=new OffscreenCanvas(o,r),c=g.getContext("2d"),d=await new Promise((t=>{const e=new Image(o,r);e.onload=()=>t(e),e.src=p}));c.drawImage(d,0,0,o,r);const l=await g.convertToBlob({type:`image/${s.state.settings.exportFormat}`,quality:.8});var i=new FileReader;i.readAsDataURL(l),i.onloadend=function(){var t=i.result;return e(t,`${(a.name||"export").toUpperCase()}.${s.state.settings.exportFormat}`)}}}export function stringToBlob(t){const e=(new TextEncoder).encode(t);return new Blob([e],{type:"application/json;charset=utf-8"})}