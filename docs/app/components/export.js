import t from"/cdn/save-svg-as-png";import{openUri as e}from"/Views/card-editor.js";export default async function(a,s,n){const o=s.width.baseVal.value,r=s.height.baseVal.value;if("json"===n.state.settings.exportFormat)return e(`data:application/json;base64,${btoa(JSON.stringify(a,null,"\t"))}`,`${(a.name||"export").toUpperCase()}.json`);if("svg"===n.state.settings.exportFormat){const n=await t.svgAsDataUri(s,{excludeUnusedCss:!0,width:o,height:r});e(n,`${(a.name||"export").toUpperCase()}.svg}`)}else{const p=await t.svgAsPngUri(s,{excludeUnusedCss:!0,width:o,height:r});if("png"===n.state.settings.exportFormat)return e(p,`${(a.name||"export").toUpperCase()}.png}`);const g=new OffscreenCanvas(o,r),d=g.getContext("2d"),c=await new Promise((t=>{const e=new Image(o,r);e.onload=()=>t(e),e.src=p}));d.drawImage(c,0,0);const l=await g.convertToBlob({type:`image/${n.state.settings.exportFormat}`,quality:.8});var i=new FileReader;i.readAsDataURL(l),i.onloadend=function(){var t=i.result;e(t,`${(a.name||"export").toUpperCase()}.${n.state.settings.exportFormat}}`)}}}