import e from"/Components/card-template/svg-wrap.js";import{useState as s,useContext as t}from"/cdn/react";import{isRitoCard as r}from"./card-name.js";import c,{div as o}from"/Utils/elements.js";import{getRitoCardImage as n,getCard as i}from"/Utils/service.js";import a from"/Utils/load-css.js";import{typeToComponent as d}from"/Views/list.js";import l from"/Utils/use-asset-cache.js";import m from"/Utils/datauri.js";import u from"./poc-sticker-stack.js";import{Globals as p}from"/Views/index.js";const k=a("/Components/deck/deck-card.css"),f=[];export function isExternalImage(e){return 1===Object.keys(e).length&&e.url}export default c((function(e){const[t,c]=s(!1),[n,a,d]=l((s=>{const t=[];for(let s=1;s<(e.count||1);t.push(void 0),s++);if(r(e.card)){const r=InDeckRitoCard({...e.card,isInclusion:e.isInclusion});s([r,r,t]),c("Spell"===e.card.type||"spell"===e.card.type||"Equipment"===e.card.type||"equipment"===e.card.type)}else if(isExternalImage(e.card)){const r=ExternalCustomCard({...e.card,isInclusion:e.isInclusion});s([r,r,t]),c(!0)}else i(e.card.id).then((r=>{Object.keys(r).length||(r=e.card);const o=InDeckCustomCard({...r,isInclusion:!0}),n=InDeckCustomCard({...r,name:void 0,blueWords:f,orangeWords:f,effectText:"",levelText:"",keywords:f,isInclusion:e.isInclusion});s([o,n,t]),c("Spell"===e.card.type||"spell"===e.card.type)}))}),[e.card,e.count],[void 0,void 0,[]]),m="keyword"===e.card.type,p="poc"===e.card.type;return m||p||e.single?n:o({style:{width:(e.cardSize||{}).width,height:(e.cardSize||{}).height},className:"in-deck-card-stack"},o({className:"in-deck-card-stack-sizer"},m?void 0:d.map(((s,t)=>o({key:t,className:"shadow-card",style:{transform:`translate(${Math.min(50,100/(e.count-1||1))*(t+1)}px, ${-Math.min(50,100/(e.count-1||1))*(t+1)}px)`}},a))).reverse(),o({className:"real-card"},n),e.stickers?o({className:"stickers "+(t?"spell":"")},u({stickers:e.stickers})):void 0))}),k);export const InDeckRitoCard=c((function(s){const r=t(p),c=s.cardCode,i=s.set,a=l((e=>{n(i,c,{},r.state.settings.lang).then(e)}),[c,i]);return e({loading:!a,isInclusion:s.isInclusion},a?o({className:"in-deck-rito-card",style:{backgroundImage:`url(${a})`}}):void 0)}),k);export const InDeckCustomCard=c((function(e){return l((s=>{s(d(e.type)(e))}),Object.keys(e).map((s=>e[s])))}),k);export const ExternalCustomCard=c((function(s){const t=l((e=>{m(s.url).then(e)}),[s.url]);return e({loading:!t,isInclusion:s.isInclusion},t?o({className:"in-deck-rito-card",style:{backgroundImage:`url(${t})`}}):void 0)}),k);