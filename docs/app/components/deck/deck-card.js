import e from"/Components/card-template/svg-wrap.js";import{useState as t}from"/cdn/react";import{isRitoCard as r}from"./card-name.js";import s,{div as c}from"/Utils/elements.js";import{getRitoCardImage as a,getCard as o}from"/Utils/service.js";import n from"/Utils/load-css.js";import{typeToComponent as d}from"/Views/list.js";import i from"/Utils/use-asset-cache.js";import l from"/Utils/datauri.js";import m from"./poc-sticker-stack.js";const p=n("/Components/deck/deck-card.css"),u=[];export function isExternalImage(e){return 1===Object.keys(e).length&&e.url}export default s((function(e){const[s,a]=t(!1),[n,d,l]=i((t=>{const s=[];for(let t=1;t<(e.count||1);s.push(void 0),t++);if(r(e.card)){const r=InDeckRitoCard(e.card);t([r,r,s]),a("Spell"===e.card.type||"spell"===e.card.type||"Equipment"===e.card.type||"equipment"===e.card.type)}else if(isExternalImage(e.card)){const r=ExternalCustomCard(e.card);t([r,r,s]),a(!0)}else o(e.card.id).then((r=>{Object.keys(r).length||(r=e.card);const c=InDeckCustomCard(r),o=InDeckCustomCard({...r,name:void 0,blueWords:u,orangeWords:u,effectText:"",levelText:"",keywords:u});t([c,o,s]),a("Spell"===e.card.type||"spell"===e.card.type)}))}),[e.card,e.count],[void 0,void 0,[]]),p="keyword"===e.card.type;return p||e.single?n:c({style:{width:(e.cardSize||{}).width,height:(e.cardSize||{}).height},className:"in-deck-card-stack"},c({className:"in-deck-card-stack-sizer"},p?void 0:l.map(((t,r)=>c({key:r,className:"shadow-card",style:{transform:`translate(${Math.min(50,100/(e.count-1||1))*(r+1)}px, ${-Math.min(50,100/(e.count-1||1))*(r+1)}px)`}},d))).reverse(),c({className:"real-card"},n),e.stickers?c({className:"stickers "+(s?"spell":"")},m({stickers:e.stickers})):void 0))}),p);export const InDeckRitoCard=s((function(t){const r=t.cardCode,s=t.set,o=i((e=>{a(s,r).then(e)}),[r,s]);return e({loading:!o},o?c({className:"in-deck-rito-card",style:{backgroundImage:`url(${o})`}}):void 0)}),p);export const InDeckCustomCard=s((function(e){return i((t=>{t(d(e.type)(e))}),Object.keys(e).map((t=>e[t])))}),p);export const ExternalCustomCard=s((function(t){const r=i((e=>{l(t.url).then(e)}),[t.url]);return e({loading:!r},r?c({className:"in-deck-rito-card",style:{backgroundImage:`url(${r})`}}):void 0)}),p);