import t from"/Components/card-template/svg-wrap.js";import{createElement as e}from"/cdn/react";import{isRitoCard as r}from"./card-name.js";import o,{div as s}from"/Utils/elements.js";import{getRitoCardImage as a,getCard as c}from"/Utils/service.js";import n from"/Utils/load-css.js";import{typeToComponent as d}from"/Views/list.js";import i from"/Utils/use-asset-cache.js";import m from"/Utils/datauri.js";const l=n("/Components/deck/deck-card.css"),u=[];export function isExternalImage(t){return 1===Object.keys(t).length&&t.url}export default o((function(t){const[e,o,a]=i((e=>{const o=[];for(let e=1;e<(t.count||1);o.push(void 0),e++);if(r(t.card)){const r=InDeckRitoCard(t.card);e([r,r,o])}else if(isExternalImage(t.card)){const r=ExternalCustomCard(t.card);e([r,r,o])}else c(t.card.id).then((t=>{const r=InDeckCustomCard(t),s=InDeckCustomCard({...t,name:void 0,blueWords:u,orangeWords:u,effectText:"",levelText:"",keywords:u});e([r,s,o])}))}),[t.card,t.count],[void 0,void 0,[]]),n="keyword"===t.card.type;return s({style:{width:(t.cardSize||{}).width,height:(t.cardSize||{}).height},className:"in-deck-card-stack"},s({className:"in-deck-card-stack-sizer"},n?void 0:a.map(((e,r)=>s({key:r,className:"shadow-card",style:{transform:`translate(${-Math.min(50,100/(t.count-1||1))*(r+1)}px, ${-Math.min(50,100/(t.count-1||1))*(r+1)}px)`}},o))).reverse(),s({className:"real-card"},e)))}),l);export const InDeckRitoCard=o((function(e){const r=e.cardCode,o=e.set,c=i((t=>{a(o,r).then(t)}),[r,o]);return t({loading:!c},c?s({className:"in-deck-rito-card",style:{backgroundImage:`url(${c})`}}):void 0)}),l);export const InDeckCustomCard=o((function(t){return i((e=>{e(d(t.type)(t))}),Object.keys(t).map((e=>t[e])))}),l);export const ExternalCustomCard=o((function(e){const r=i((t=>{m(e.url).then(t)}),[e.url]);return t({loading:!r},r?s({className:"in-deck-rito-card",style:{backgroundImage:`url(${r})`}}):void 0)}),l);