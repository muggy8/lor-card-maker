import e from"/Components/card-template/svg-wrap.js";import{useState as s}from"/cdn/react";import{isRitoCard as t}from"./card-name.js";import r,{div as c}from"/Utils/elements.js";import{getRitoCardImage as o,getCard as n}from"/Utils/service.js";import i from"/Utils/load-css.js";import{typeToComponent as a}from"/Views/list.js";import d from"/Utils/use-asset-cache.js";import l from"/Utils/datauri.js";import m from"./poc-sticker-stack.js";const u=i("/Components/deck/deck-card.css"),p=[];export function isExternalImage(e){return 1===Object.keys(e).length&&e.url}export default r((function(e){const[r,o]=s(!1),[i,a,l]=d((s=>{const r=[];for(let s=1;s<(e.count||1);r.push(void 0),s++);if(t(e.card)){const t=InDeckRitoCard({...e.card,isInclusion:e.isInclusion});s([t,t,r]),o("Spell"===e.card.type||"spell"===e.card.type||"Equipment"===e.card.type||"equipment"===e.card.type)}else if(isExternalImage(e.card)){const t=ExternalCustomCard({...e.card,isInclusion:e.isInclusion});s([t,t,r]),o(!0)}else n(e.card.id).then((t=>{Object.keys(t).length||(t=e.card);const c=InDeckCustomCard({...t,isInclusion:!0}),n=InDeckCustomCard({...t,name:void 0,blueWords:p,orangeWords:p,effectText:"",levelText:"",keywords:p,isInclusion:e.isInclusion});s([c,n,r]),o("Spell"===e.card.type||"spell"===e.card.type)}))}),[e.card,e.count],[void 0,void 0,[]]),u="keyword"===e.card.type,k="poc"===e.card.type;return u||k||e.single?i:c({style:{width:(e.cardSize||{}).width,height:(e.cardSize||{}).height},className:"in-deck-card-stack"},c({className:"in-deck-card-stack-sizer"},u?void 0:l.map(((s,t)=>c({key:t,className:"shadow-card",style:{transform:`translate(${Math.min(50,100/(e.count-1||1))*(t+1)}px, ${-Math.min(50,100/(e.count-1||1))*(t+1)}px)`}},a))).reverse(),c({className:"real-card"},i),e.stickers?c({className:"stickers "+(r?"spell":"")},m({stickers:e.stickers})):void 0))}),u);export const InDeckRitoCard=r((function(s){const t=s.cardCode,r=s.set,n=d((e=>{o(r,t).then(e)}),[t,r]);return e({loading:!n,isInclusion:s.isInclusion},n?c({className:"in-deck-rito-card",style:{backgroundImage:`url(${n})`}}):void 0)}),u);export const InDeckCustomCard=r((function(e){return d((s=>{s(a(e.type)(e))}),Object.keys(e).map((s=>e[s])))}),u);export const ExternalCustomCard=r((function(s){const t=d((e=>{l(s.url).then(e)}),[s.url]);return e({loading:!t,isInclusion:s.isInclusion},t?c({className:"in-deck-rito-card",style:{backgroundImage:`url(${t})`}}):void 0)}),u);