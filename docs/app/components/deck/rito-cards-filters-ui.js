import{useEffect as e,useContext as t,useRef as l}from"/cdn/react";import s,{div as r,strong as o,img as i,button as a}from"/Utils/elements.js";import{Globals as n}from"/Views/index.js";import c from"/Utils/load-css.js";import d from"/Utils/use-toggle.js";import p from"/Utils/use-lang.js";import u from"/Components/deck/search-text.js";import v from"/Components/deck/checkbox.js";import f from"/Components/deck/range-slider.js";import{KeywordImageCheck as g}from"/Components/card-config/edit-keywords.js";import h from"/Utils/use-asset-cache.js";import{getRitoSetIconData as m}from"/Utils/service.js";const b=c("/Components/deck/rito-cards-filters-ui.css");export default s((function(s){const c=p(),h=t(n),m=!0===h.state.settings.lowSpecsMode,b=l();b.current=h;const k=l(),[F,y]=k.current=d(!1);return e((()=>{const e=h.getAllowBack();return b.current.setAllowBack(t),function(){b.current.getAllowBack()===t&&b.current.setAllowBack(e)};function t(){const[t,l]=k.current;return t?(l(!1),!1):e()}}),[]),r({className:"filter-slider gutter-b-1 "+(F?"expanded":"")},r({className:"flex no-wrap vcenter"},r({className:"grow clickable gutter-rl-.5",onClick:y},o(c("filter"))),r({className:`icon clickable ${m?"":"animated"} ${F?"minus":"menu"}`,onClick:y})),r({className:"options"},r({className:"gutter-rbl-.5"},r({className:"flex gutter-b"},a({onClick:s.refreshRitoData,className:"gutter-trbl-.5 grow"},s.refreshRitoLoading?r({className:"icon loading"}):c("refresh_rito_data")),r({className:"gutter-r-.5"}),a({onClick:()=>{s.updateSelectedFilters({collectible:{value:!0},name:{value:void 0},descriptionRaw:{value:void 0},subtypes:{value:void 0},rarity:{value:void 0},regionRefs:{value:void 0},cost:{value:void 0},type:{value:void 0},health:{value:void 0},attack:{value:void 0},spellSpeed:{value:void 0},keywords:{value:void 0}})},className:"gutter-trbl-.5 grow"},c("clear_filters"))),s.filterOptions.collectible&&s.filterOptions.collectible.length?v({label:c("collectible"),value:s.selectedFilters.collectible&&s.selectedFilters.collectible.value,onChange:e=>{s.updateSelectedFilter("collectible",{value:e})},options:s.filterOptions.collectible,renderOption:e=>r({className:"flex vhcenter clickable gutter-trbl-.5"},e?"✔ "+c("yes"):"✘ "+c("no"))}):void 0,s.filterOptions.name&&s.filterOptions.name.length?u({label:c("name"),value:s.selectedFilters.name?s.selectedFilters.name.value:"",onChange:e=>s.updateSelectedFilter("name",{value:e})}):void 0,s.filterOptions.descriptionRaw&&s.filterOptions.descriptionRaw.length?u({label:c("card_text"),value:s.selectedFilters.descriptionRaw?s.selectedFilters.descriptionRaw.value:"",onChange:e=>s.updateSelectedFilter("descriptionRaw",{value:e})}):void 0,s.filterOptions.subtypes&&s.filterOptions.subtypes.length?u({label:c("clan"),value:s.selectedFilters.subtypes?s.selectedFilters.subtypes.value:"",onChange:e=>s.updateSelectedFilter("subtypes",{value:e})}):void 0,s.filterOptions.regionRefs&&s.filterOptions.regionRefs.length?v({label:c("region"),value:s.selectedFilters.regionRefs&&s.selectedFilters.regionRefs.value||[],onChange:e=>{s.updateSelectedFilter("regionRefs",{value:e})},options:s.filterOptions.regionRefs,renderOption:(e,t)=>"none"===e.toLowerCase()?null:r({className:(t?"":"ghost ")+"icon-checkbox flex vhcenter clickable gutter-trbl-.5"},i({src:`/Assets/region/${e.toLowerCase()}.png`}))}):void 0,s.filterOptions.rarity&&s.filterOptions.rarity.length?v({label:c("rarity"),value:s.selectedFilters.rarity&&s.selectedFilters.rarity.value||[],onChange:e=>{s.updateSelectedFilter("rarity",{value:e})},options:s.filterOptions.rarity,renderOption:(e,t)=>"none"===e.toLowerCase()?null:r({className:(t?"":"ghost ")+"icon-checkbox flex vhcenter clickable gutter-trbl-.5"},i({src:`/Assets/shared/${e.toLowerCase()}.png`}))}):void 0,s.filterOptions.cost&&s.filterOptions.cost.length?f({label:c("mana_cost"),range:s.filterOptions.cost,value:s.selectedFilters.cost&&s.selectedFilters.cost.value,onChange:e=>s.updateSelectedFilter("cost",{value:e})}):void 0,s.filterOptions.type&&s.filterOptions.type.length?v({label:c("card_type"),value:s.selectedFilters.type&&s.selectedFilters.type.value||[],onChange:e=>{s.updateSelectedFilter("type",{value:e}),e.some((e=>"unit"===e.toLowerCase()))||(s.updateSelectedFilter("health",{value:void 0}),s.updateSelectedFilter("attack",{value:void 0})),e.some((e=>"spell"===e.toLowerCase()))||s.updateSelectedFilter("spellSpeed",{value:void 0})},options:s.filterOptions.type,renderOption:(e,t)=>r({className:"icon-checkbox flex vhcenter clickable gutter-trbl-.5"},g({isChecked:t,keywordName:e.toLowerCase()}))}):void 0,s.filterOptions.spellSpeed&&s.filterOptions.spellSpeed.length&&Array.prototype.some.call((s.selectedFilters.type||{}).value||[],(e=>"spell"===e.toLowerCase()))?v({label:c("speed"),value:s.selectedFilters.spellSpeed&&s.selectedFilters.spellSpeed.value||[],onChange:e=>{s.updateSelectedFilter("spellSpeed",{value:e})},options:s.filterOptions.spellSpeed,renderOption:(e,t)=>e?r({className:"icon-checkbox flex vhcenter clickable gutter-trbl-.5"},g({isChecked:t,keywordName:e.toLowerCase()})):void 0}):void 0,s.filterOptions.attack&&s.filterOptions.attack.length&&Array.prototype.some.call((s.selectedFilters.type||{}).value||[],(e=>"unit"===e.toLowerCase()))?f({label:c("power"),range:s.filterOptions.attack,value:s.selectedFilters.attack&&s.selectedFilters.attack.value,onChange:e=>s.updateSelectedFilter("attack",{value:e})}):void 0,s.filterOptions.health&&s.filterOptions.health.length&&Array.prototype.some.call((s.selectedFilters.type||{}).value||[],(e=>"unit"===e.toLowerCase()))?f({label:c("health"),range:s.filterOptions.health,value:s.selectedFilters.health&&s.selectedFilters.health.value,onChange:e=>s.updateSelectedFilter("health",{value:e})}):void 0,s.filterOptions.set&&s.filterOptions.set.length?v({label:c("expantion"),value:s.selectedFilters.rarity&&s.selectedFilters.set.value||[],onChange:e=>{s.updateSelectedFilter("set",{value:e})},options:s.filterOptions.set,renderOption:(e,t)=>"none"===e.toLowerCase()?null:r({className:(t?"":"ghost ")+"icon-checkbox clickable gutter-trbl-.5"},SetIcon({set:e}))}):void 0,s.filterOptions.keywords&&s.filterOptions.keywords.length?v({label:c("keyword"),value:s.selectedFilters.keywords&&s.selectedFilters.keywords.value||[],onChange:e=>{s.updateSelectedFilter("keywords",{value:e})},options:s.filterOptions.keywords,renderOption:(e,t)=>r({className:"icon-checkbox flex vhcenter clickable gutter-trbl-.5"},g({isChecked:t,keywordName:e.toLowerCase()}))}):void 0)))}),b);export const SetIcon=s((function(e){const t=h((t=>{e.set&&m(e.set).then(t)}),[e.set]);return t?r({className:"flex vcenter hstart no-wrap"},i({src:t.url}),r({className:"gutter-l-.5"},t.name)):void 0}));