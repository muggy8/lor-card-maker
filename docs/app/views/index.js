import{useState as t,useCallback as e,useEffect as n,useRef as o,createContext as i,createElement as r}from"/cdn/react";import s from"/Utils/elements.js";import a from"/Views/list.js";import{BannerBar as c,SideBar as l}from"/Components/index.js";import{getSettings as p,saveSettings as u}from"/Utils/service.js";import v from"/Utils/set-immediate-batch.js";export const Globals=i({lang:"en",card:null});export let navigationHistory=[];export default s((function(i){const[s,v]=t({lang:"en",view:a,defaultBg:!0,settings:{}});let g={...s};const m=e((t=>{let e={...g,...t};Object.keys(e).forEach((t=>{void 0===e[t]&&delete e[t]})),g=e;Object.keys(e).map((t=>e[t]!==s[t])).reduce(((t,e)=>t||e),!1)&&v(e)}),[s,v]);n((()=>{p().then((t=>m({settings:t})))}),[]);const d=e((t=>{const e={...s.settings,...t};m({settings:e}),u(e)}),[s.settings,m]),h=o();n((()=>{h.current=m}),[m]);const w=o((()=>!0));n((()=>{navigationHistory.push(s.view);const t=function(t){if(!1===w.current())return t.preventDefault(),t.stopPropagation(),void history.pushState({},"");navigationHistory.splice(-1,1);const e=navigationHistory[navigationHistory.length-1];if(!e)return navigationHistory.push(s.view),h.current({view:a});h.current({view:e})};return window.addEventListener("popstate",t),function(){window.removeEventListener("popstate",t)}}),[]);const f=e((t=>{window.scrollTo(0,0),requestAnimationFrame((()=>{h.current({view:t}),history.pushState({},""),navigationHistory.push(t)}))}),[]);return n((()=>{if(!i.root)return;const t=(s.bannerHeight||0)+"px";i.root.style.setProperty("padding-top",t),i.root.style.setProperty("--banner-height",t)}),[s.bannerHeight,i.root]),r(Globals.Provider,{value:{state:s,setState:v,patchState:m,setView:f,patchSettings:d,allowBack:w.current,setAllowBack:t=>{w.current=t}}},c(),l(),s.view())}));