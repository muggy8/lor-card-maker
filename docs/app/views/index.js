import{useState as t,useCallback as e,useEffect as n,useRef as o,createContext as r,createElement as i}from"/cdn/react";import s,{section as a}from"/Utils/elements.js";import c from"/Views/list.js";import{BannerBar as p,SideBar as l}from"/Components/index.js";import{getSettings as u,saveSettings as v}from"/Utils/service.js";export const Globals=r({lang:"en",card:null});export let navigationHistory=[];export default s((function(r){const[s,a]=t({lang:"en",view:c,defaultBg:!0,settings:{}});let g={...s};const d=e((t=>{let e={...g,...t};Object.keys(e).forEach((t=>{void 0===e[t]&&delete e[t]})),g=e;Object.keys(e).map((t=>e[t]!==s[t])).reduce(((t,e)=>t||e),!1)&&a(e)}),[s,a]);n((()=>{u().then((t=>d({settings:t})))}),[]);const h=e((t=>{const e={...s.settings,...t};d({settings:e}),v(e)}),[s.settings,d]),f=o();n((()=>{f.current=d}),[d]);const w=o((()=>!0));n((()=>{navigationHistory.push(s.view);const t=function(t){if(!1===w.current())return t.preventDefault(),t.stopPropagation(),void history.pushState({},"");navigationHistory.splice(-1,1);const e=navigationHistory[navigationHistory.length-1];if(!e)return navigationHistory.push(s.view),f.current({view:c});f.current({view:e})};return window.addEventListener("popstate",t),function(){window.removeEventListener("popstate",t)}}),[]);const y=e((t=>{f.current({view:t}),history.pushState({},""),navigationHistory.push(t)}),[]);return n((()=>{if(!r.root)return;const t=(s.bannerHeight||0)+"px";r.root.style.setProperty("padding-top",t),r.root.style.setProperty("--banner-height",t)}),[s.bannerHeight,r.root]),i(Globals.Provider,{value:{state:s,setState:a,patchState:d,setView:y,patchSettings:h,allowBack:w.current,setAllowBack:t=>{w.current=t}}},p(),l(),s.view())}));