import t from"/Utils/concurrency-manager.js";function e(t){const e=Object.keys(t);if(!e.length)return"";const n=[];return e.forEach((e=>{let o=t[e];Array.isArray(o)&&(o=o.join(",")),n.push([e,o].join("="))})),"?"+n.join("&")}export function getCardList(t={}){return fetch("/pseudo-api/card-list/"+e(t)).then((t=>t.json()))}export function getCard(t,n={}){return fetch("/pseudo-api/card/"+t+e(n)).then((t=>t.json()))}export function saveCard(t,e){return fetch("/pseudo-api/card/"+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}export function deleteCard(t){return fetch("/pseudo-api/card/"+t,{method:"DEL"})}export function getSettings(t={}){return fetch("/pseudo-api/settings/"+e(t)).then((t=>t.json()))}export function saveSettings(t){return fetch("/pseudo-api/settings/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}export function getRitoCards(t={}){return fetch("/pseudo-api/game-data/card-list/"+e(t)).then((t=>t.json()))}const n=t();export function patchRitoCards(t){return new Promise(((e,o)=>{n.sequential((async()=>{const n={...await getRitoCards(),...t};return fetch("/pseudo-api/game-data/card-list/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(e,o)}))}))}export async function getLatestRitoData(t={}){t.t=Date.now();const n=e(t),o="https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/data/globals-en_us.json"+n,r=await fetch(o).then((t=>t.json())),a=r.sets.map((t=>{const e=t.nameRef.toLowerCase();return fetch(`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_${e}/data/${e}-en_us.json${n}`).then((t=>t.json())).then((e=>{t.data=e})).catch((()=>{}))}));return await Promise.all(a),r.sets.filter((t=>t.data)),r}const o={};export function getRitoCardImage(t,n,r={}){if(o[t]&&o[t][n])return o[t][n];o[t]=o[t]||{};const a=t.toLowerCase();return r.t=Date.now(),o[t][n]=fetch(`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_${a}/img/cards/en_us/${n}.png?${e(r)}`).then((t=>t.blob())).then((t=>{const e=new FileReader;return new Promise((n=>{e.addEventListener("load",(()=>{n(e.result)}),!1),e.readAsDataURL(t)}))}))}const r={};export function getRitoSetIconData(t,n={}){return r[t]?r[t]:(n.t=Date.now(),r[t]=new Promise((async(o,a)=>{const s="https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/data/globals-en_us.json"+e(n),i=await fetch(s).then((t=>t.json())),c=Array.prototype.find.call(i.sets,(e=>e.nameRef===t));c||(delete r[t],a(new Error("Unknown Set")));const d=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/${/img\/sets\/([^\/\n]+)$/gim.exec(c.iconAbsolutePath)[0].replace("_crispmip","")}`,p=await fetch(d).then((t=>t.blob())),h=new FileReader;h.addEventListener("load",(()=>{o({url:h.result,name:c.name})}),!1),h.readAsDataURL(p)})))}