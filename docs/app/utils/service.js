import{mergeDeep as e}from"./use-filter.js";import t from"/Utils/concurrency-manager.js";function n(e){const t=Object.keys(e);if(!t.length)return"";const n=[];return t.forEach((t=>{let r=e[t];void 0!==r&&(Array.isArray(r)&&(r=r.join(",")),r&&n.push([t,r].join("=")))})),"?"+n.join("&")}export function getCardList(e={}){return fetch("/pseudo-api/card-list/"+n(e)).then((e=>e.json()))}export function getBackup(e={}){return fetch("/pseudo-api/backup/"+n(e)).then((e=>e.json()))}export function getCard(e,t={}){return fetch("/pseudo-api/card/"+e+n(t)).then((e=>e.json()))}export function saveCard(e,t){return fetch("/pseudo-api/card/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}export function deleteCard(e){return fetch("/pseudo-api/card/"+e,{method:"DEL"})}export function getSettings(e={}){return fetch("/pseudo-api/settings/"+n(e)).then((e=>e.json()))}export function saveSettings(e){return fetch("/pseudo-api/settings/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}export function getRitoCards(e={}){return fetch("/pseudo-api/game-data/card-list/"+n(e)).then((e=>e.json()))}const r=t();export function patchRitoCards(e){return new Promise(((t,n)=>{r.sequential((async()=>{const r={...await getRitoCards(),...e};return fetch("/pseudo-api/game-data/card-list/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t,n)}))}))}export async function getLatestRitoData(e={},t="en_us"){e.t=Date.now();const r=n(e),o=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/data/globals-${t}.json`+r,a=await fetch(o).then((e=>e.json())),i=a.sets.map((e=>{const n=e.nameRef.toLowerCase();return fetch(`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_${n}/data/${n}-${t}.json${r}`).then((e=>e.json())).then((t=>{e.data=t})).catch((()=>{}))}));return await Promise.all(i),a.sets.filter((e=>e.data)),a}export async function getRitoPoCItemRelic(t={},r){return fetch("/pseudo-api/game-data/poc-item-relic-list/"+n(t)).then((e=>e.json())).then((t=>e(r,t)))}export function patchRitoPocItemRelic(e){return new Promise(((t,n)=>{r.sequential((async()=>{const r={...await getRitoPoCItemRelic(),...e};return fetch("/pseudo-api/game-data/poc-item-relic-list/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t,n)}))}))}export async function getLatestPoCItemRelicData(e={},t="en_us"){e.t=Date.now();const r=n(e),o=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/data/items-${t}.json`+r,a=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/data/relics-${t}.json`+r,[i,s]=await Promise.all([fetch(o).then((e=>e.json())),fetch(a).then((e=>e.json()))]);return Array.prototype.forEach.call(i,(e=>{e.url=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/img/items/${t}/${e.itemCode}.png${r}`,e.urlFull=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/img/items/${t}/${e.itemCode}-full.png${r}`})),Array.prototype.sort.call(i,c),Array.prototype.forEach.call(s,(e=>{e.url=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/img/relics/${t}/${e.relicCode}.png${r}`,e.urlFull=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/img/relics/${t}/${e.relicCode}-full.png${r}`})),Array.prototype.sort.call(s,c),{items:i,relics:s};function c(e,t){return d(e.rarityRef)-d(t.rarityRef)||e.name.localeCompare(t.name)}function d(e){switch(e){case"common":case"Common":case"COMMON":return 1;case"rare":case"Rare":case"RARE":return 2;case"epic":case"Epic":case"EPIC":return 3;case"legendary":case"Legendary":case"LEGENDARY":case"champion":case"Champion":case"CHAMPION":return 4;default:return 1/0}}}const o={};export function getRitoCardImage(e,t,r={},a="en_us"){if(o[e]&&o[e][t])return o[e][t];o[e]=o[e]||{};const i=e.toLowerCase();return r.t=Date.now(),o[e][t]=fetch(`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_${i}/img/cards/${a}/${t}.png?${n(r)}`).then((e=>e.blob())).then((e=>{const t=new FileReader;return new Promise((n=>{t.addEventListener("load",(()=>{n(t.result)}),!1),t.readAsDataURL(e)}))}))}const a={};export function getRitoSetIconData(e,t={},r="en_us"){return a[e]?a[e]:(t.t=Date.now(),a[e]=new Promise((async(o,i)=>{const s=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/data/globals-${r}.json`+n(t),c=await fetch(s).then((e=>e.json())),d=Array.prototype.find.call(c.sets,(t=>t.nameRef===e));d||(delete a[e],i(new Error("Unknown Set")));const p=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/${/img\/sets\/([^\/\n]+)$/gim.exec(d.iconAbsolutePath)[0].replace("_crispmip","")}`,u=await fetch(p).then((e=>e.blob())),l=new FileReader;l.addEventListener("load",(()=>{o({url:l.result,name:d.name})}),!1),l.readAsDataURL(u)})))}