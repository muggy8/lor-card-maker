import{mergeDeep as e}from"./use-filter.js";import t from"/Utils/concurrency-manager.js";function n(e){const t=Object.keys(e);if(!t.length)return"";const n=[];return t.forEach((t=>{let r=e[t];void 0!==r&&(Array.isArray(r)&&(r=r.join(",")),n.push([t,r].join("=")))})),"?"+n.join("&")}export function getCardList(e={}){return fetch("/pseudo-api/card-list/"+n(e)).then((e=>e.json()))}export function getBackup(e={}){return fetch("/pseudo-api/backup/"+n(e)).then((e=>e.json()))}export function getCard(e,t={}){return fetch("/pseudo-api/card/"+e+n(t)).then((e=>e.json()))}export function saveCard(e,t){return fetch("/pseudo-api/card/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}export function deleteCard(e){return fetch("/pseudo-api/card/"+e,{method:"DEL"})}export function getSettings(e={}){return fetch("/pseudo-api/settings/"+n(e)).then((e=>e.json()))}export function saveSettings(e){return fetch("/pseudo-api/settings/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}export function getRitoCards(e={}){return fetch("/pseudo-api/game-data/card-list/"+n(e)).then((e=>e.json()))}const r=t();export function patchRitoCards(e){return new Promise(((t,n)=>{r.sequential((async()=>{const r={...await getRitoCards(),...e};return fetch("/pseudo-api/game-data/card-list/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t,n)}))}))}export async function getLatestRitoData(e={}){e.t=Date.now();const t=n(e),r="https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/data/globals-en_us.json"+t,o=await fetch(r).then((e=>e.json())),a=o.sets.map((e=>{const n=e.nameRef.toLowerCase();return fetch(`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_${n}/data/${n}-en_us.json${t}`).then((e=>e.json())).then((t=>{e.data=t})).catch((()=>{}))}));return await Promise.all(a),o.sets.filter((e=>e.data)),o}export async function getRitoPoCItemRelic(t={},r){return fetch("/pseudo-api/game-data/poc-item-relic-list/"+n(t)).then((e=>e.json())).then((t=>e(r,t)))}export function patchRitoPocItemRelic(e){return new Promise(((t,n)=>{r.sequential((async()=>{const r={...await getRitoPoCItemRelic(),...e};return fetch("/pseudo-api/game-data/poc-item-relic-list/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t,n)}))}))}export async function getLatestPoCItemRelicData(e={}){e.t=Date.now();const t=n(e),r="https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/data/items-en_us.json"+t,o="https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/data/relics-en_us.json"+t,[a,s]=await Promise.all([fetch(r).then((e=>e.json())),fetch(o).then((e=>e.json()))]);return Array.prototype.forEach.call(a,(e=>{e.url=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/img/items/en_us/${e.itemCode}.png${t}`,e.urlFull=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/img/items/en_us/${e.itemCode}-full.png${t}`})),Array.prototype.sort.call(a,i),Array.prototype.forEach.call(s,(e=>{e.url=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/img/relics/en_us/${e.relicCode}.png${t}`,e.urlFull=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_Adventure/img/relics/en_us/${e.relicCode}-full.png${t}`})),Array.prototype.sort.call(s,i),{items:a,relics:s};function i(e,t){return c(e.rarityRef)-c(t.rarityRef)||e.name.localeCompare(t.name)}function c(e){switch(e){case"common":case"Common":case"COMMON":return 1;case"rare":case"Rare":case"RARE":return 2;case"epic":case"Epic":case"EPIC":return 3;case"legendary":case"Legendary":case"LEGENDARY":case"champion":case"Champion":case"CHAMPION":return 4;default:return 1/0}}}const o={};export function getRitoCardImage(e,t,r={}){if(o[e]&&o[e][t])return o[e][t];o[e]=o[e]||{};const a=e.toLowerCase();return r.t=Date.now(),o[e][t]=fetch(`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon_${a}/img/cards/en_us/${t}.png?${n(r)}`).then((e=>e.blob())).then((e=>{const t=new FileReader;return new Promise((n=>{t.addEventListener("load",(()=>{n(t.result)}),!1),t.readAsDataURL(e)}))}))}const a={};export function getRitoSetIconData(e,t={}){return a[e]?a[e]:(t.t=Date.now(),a[e]=new Promise((async(r,o)=>{const s="https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/data/globals-en_us.json"+n(t),i=await fetch(s).then((e=>e.json())),c=Array.prototype.find.call(i.sets,(t=>t.nameRef===e));c||(delete a[e],o(new Error("Unknown Set")));const d=`https://cdn.jsdelivr.net/gh/InFinity54/LoR_DDragon/core/${/img\/sets\/([^\/\n]+)$/gim.exec(c.iconAbsolutePath)[0].replace("_crispmip","")}`,p=await fetch(d).then((e=>e.blob())),u=new FileReader;u.addEventListener("load",(()=>{r({url:u.result,name:c.name})}),!1),u.readAsDataURL(p)})))}