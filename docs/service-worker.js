const t=location.pathname.replace(/[^\/]+\.js$/,""),e=location.origin+t,n=location.origin+"/",s={target:"es2015","no-dts":!0,pin:"122"};let a=()=>{};e.includes("localhost")&&(s.dev=!0,a=console.log);const r={cdn:{react:{url:"https://esm.sh/react@18.2.0",query:s},"react-dom":{url:"https://esm.sh/react-dom@18.2.0",query:{...s,deps:"react@18.2.0"}},"flex-box":"https://cdn.jsdelivr.net/gh/muggy8/flex-box@d8439c58f20597e4fe891d01d6853bdcc78e82be","mmc-3":"https://cdn.jsdelivr.net/gh/muggy8/mmc-3@374aa14106e6133f758cf68f2cb9e35b5392cfe5","css-icons":"https://cdn.jsdelivr.net/gh/muggy8/css-icons@7050e6d2d096e4353efc9c2a917966817f5da81c",fitty:{url:"https://esm.sh/fitty@2.3.6",query:s},setimmediate:{url:"https://esm.sh/setimmediate@1.0.5",query:s},"fast-average-color":{url:"https://esm.sh/fast-average-color@9.1.1",query:s},"save-svg-as-png":{url:"https://esm.sh/save-svg-as-png@1.4.17",query:s},gesto:{url:"https://esm.sh/gesto@1.13.3",query:s},"react-range":{url:"https://esm.sh/react-range@1.8.14",query:s},"react-contextmenu":{url:"https://esm.sh/react-contextmenu@2.14.0",query:s},"react-select":{url:"https://esm.sh/react-select@5.6.0",query:s},"usecontextmenu-react":{url:"https://esm.sh/usecontextmenu-react@1.0.3",query:s},"react-device-detect":{url:"https://esm.sh/react-device-detect@2.2.2",query:s},"react-markdown":{url:"https://esm.sh/react-markdown@8.0.4",query:s},"object-hash":{url:"https://esm.sh/object-hash@3.0.0",query:s}},App:e+"app",Views:e+"app/views",Utils:e+"app/utils",Components:e+"app/components",Assets:e+"app/assets"};self.addEventListener("install",(function(t){a("begin install",t,location),t.waitUntil(Promise.all([self.skipWaiting(),f(e)]).then(m).then(y))})),self.addEventListener("activate",(function(t){a("activate",t),t.waitUntil(clients.claim())}));const i="pseudo-api/card/";function o(t){if(t.includes(","))return t.split(",").map(o);if("true"===t)return!0;if("false"===t)return!1;if("null"===t)return null;const e=parseFloat(t);return isNaN(e)?t:e}async function c(t,e){let n=await caches.open("cards"),s=await n.match(e);if(s){e.url&&(e=e.url);const[t,n]=e.match(l);let a=await s.json();return a.id=n,new Response(JSON.stringify(a),{"Content-Type":"application/json",status:200})}return new Response("{}",{"Content-Type":"application/json",status:200})}self.addEventListener("fetch",(function(t){const s=t.request.url.replace(n,""),d=t.request.url.replace(e,"")||e,h=function(t){const e=p(t.split("/"),r);if(e)return e;return t}(s);if(a({indexUrl:e,urlRoot:n,filePathRelativeToURLRoot:s,filePathRelativeToInstallPath:d,fetchUrl:h}),h)if(s.startsWith("pseudo-api")){let n=!1;"POST"===t.request.method||"PUT"===t.request.method?s.includes(i)?(t.respondWith(async function(t,e){let n=await t.text(),s=await caches.open("cards"),a=new Response(n,{"Content-Type":"application/json",status:200});return await s.put(e,a.clone()),a}(t.request,s)),n=!0):s.includes("pseudo-api/settings/")?(t.respondWith(async function(t,e){let n=await t.text(),s=await caches.open("settings"),a=new Response(n,{"Content-Type":"application/json",status:200});return await s.put(e,a.clone()),a}(t.request,s)),n=!0):s.includes("pseudo-api/game-data/card-list/")&&(t.respondWith(async function(t,e){let n=await t.text(),s=await caches.open("rito-data"),a=new Response(n,{"Content-Type":"application/json",status:200});return await s.put(e,a.clone()),a}(t.request,s)),n=!0):"GET"===t.request.method?s.includes("pseudo-api/card-list/")?(t.respondWith(async function(t,e){let n=await caches.open("cards"),s=(await n.keys()).filter((t=>t.url.includes(i))).map((t=>{let[e,n]=t.url.match(l);return n}));s.reverse();const a=function(t){const e=/([^\&\?\=]+)(\=([^\&\?\=]+))?/g,[n]=/\?.*?(.(?=\#)|.$)/.exec(t)||[];if(!n)return{};const s={};for(let t,a,r,i;t=e.exec(n);[i,a,i,r]=t,s[a]=o(r));return s}(t.url),r=[];if(a.only)r.push(...[a.only].flat());else{const t=a.include?[a.include].flat():[],e=a.exclude?[a.exclude].flat():[];r.push(...u.filter((t=>!e.includes(t)))),r.push(...t)}let p=s.map((async t=>{let e=await c(void 0,i+t).then((t=>t.json()));if(e.id=t,r.includes(e.type))return e})),d=await Promise.all(p);return new Response(JSON.stringify(d.filter((t=>!!t))),{"Content-Type":"application/json",status:200})}(t.request)),n=!0):s.includes(i)?(t.respondWith(c(t.request,s)),n=!0):s.includes("pseudo-api/settings/")?(t.respondWith(async function(t,e){let n=await caches.open("settings"),s=await n.match(e);if(s)return s;return new Response("{}",{"Content-Type":"application/json",status:200})}(t.request,s)),n=!0):s.includes("pseudo-api/game-data/card-list/")?(t.respondWith(async function(t,e){let n=await caches.open("rito-data"),s=await n.match(e);if(s)return s;return new Response("{}",{"Content-Type":"application/json",status:200})}(t.request,s)),n=!0):s.includes("pseudo-api/backup/")?(t.respondWith(async function(t,e){let n=await caches.open("cards"),s=(await n.keys()).filter((t=>t.url.includes(i))).map((t=>{let[e,n]=t.url.match(l);return n})),a=s.map((async t=>{let e=await c(void 0,i+t).then((t=>t.json()));return e.id=t,"deck"!==e.type||e.dataVersion||(e.dataVersion=2),e})),r=await Promise.all(a);return new Response(JSON.stringify({cards:r.filter((t=>!!t))}),{"Content-Type":"application/json",status:200})}(t.request)),n=!0):s.includes("pseudo-api/clear-cache/")&&(t.respondWith(async function(t,n){let s=await caches.open("react-cache"),a=await s.keys(),r=await Promise.all(a.map((async t=>{let e=(await s.match(t)).headers.get("Content-Type");if(!e||!e.includes("html"))return s.delete(t.url)})));return await Promise.all(r),Response.redirect(e,302)}(t.request)),n=!0):"DEL"===t.request.method&&s.includes(i)&&(t.respondWith(async function(t,e){let n=await caches.open("cards");return await n.delete(e),new Response("{}",{"Content-Type":"application/json",status:200})}(t.request,s)),n=!0),!n&&t.respondWith(new Response("Not found",{"Content-Type":"text/plain",status:404}))}else h===s?h.includes("LoR_DD")?t.respondWith(fetch(h)):t.respondWith(f(d)):h.includes("LoR_DD")?t.respondWith(fetch(h)):t.respondWith(f(h,s.startsWith("cdn")));else t.respondWith(f(t.request))}));const l=/\/([^\/]+)\/?$/,u=["champion1","champion2","champion3","landmark","follower","spell","keyword"];function p(t,e){if(!t||!t.length||!e)return;const n=t[0],s=t.slice(1),a=e[n];if("string"==typeof a||"object"==typeof a&&"string"==typeof a.url){let t=["string"==typeof a?a:a.url,...s].join("/");if(a.query){let e=Object.keys(a.query).map((t=>`${t}=${a.query[t]}`)).join("&");t.endsWith(".css")&&(e+="&css=true"),t=t+"?"+e}return t}return p(s,a)}function d(t){return new Promise((e=>setTimeout(e,t)))}Object.freeze(u);const h=new class{constructor(){this.start=void 0,this.end=void 0,this.length=0}get first(){return this.start}get last(){return this.end}set first(t){return this.start=t}set last(t){return this.end=t}add(t){const e=function(t,e={}){let n;n="object"!=typeof e?Object.create({data:e}):Object.create(e);return n.next=void 0,n.prev=void 0,n.get=function(t){return e[t]},n.drop=function(){n.next&&(n.next.prev=n.prev),n.prev&&(n.prev.next=n.next),t.start===n&&(t.start=n.next),t.end===n&&(t.end=n.prev),t.length--},n}(this,t);return this.start||(this.start=e),this.end?(e.prev=this.end,this.end.next=e,this.end=e):this.end=e,this.length++,e}};async function f(t,e=!1){let n,s=t.url||t;if(s.includes("://")&&!s.startsWith("http"))return fetch(t);const r=await caches.open("react-cache");if(e&&(n=await r.match(t),n))return n;let i;if(n=await r.match(t)){let e=n.headers.get("etag"),r=n.headers.get("last-modified");n.headers.get("Content-Length");if(i=await n.clone().text(),i){let i,o=0,c=2;for(a(`Execution for ${s}: Start HEAD loop`);!i&&o<c;){o++;let c=200*o;try{a(`HEAD ${s}: there are currently ${h.length} other ongoing other fetches`);let e=fetch(t,{method:"HEAD"}),n=h.add(e);i=await e,n.drop()}catch(t){return a(`Execution for ${s}: Exit HEAD on error`),i=void 0,n}if(!i.ok||i.status>=300||i.status<200)a(`Execution for ${s}: Retry HEAD on bad status`),i=void 0,await d(c);else if(i&&i.headers){if(e&&i.headers.get("etag")===e)return a(`Execution for ${s}: Exit HEAD on etag equivilance`),n;if(r&&i.headers.get("last-modified")===r)return a(`Execution for ${s}: Exit HEAD on last-modified equivilance`),n}}if(a(`Execution for ${s}: End HEAD loop`),o>=c)return a(`Execution for ${s}: Exit HEAD on max-attempt reached`,{attempts:o,maxAttempts:c}),n;a(`Execution for ${s}: Passed attempts check`)}a("asset needs refreshing",t)}let o,c=0;for(;!o&&c<3;){c++;let e=200*c;try{a(`GET ${s}: there are currently ${h.length} other ongoing other fetches`);let e=fetch(t),n=h.add(e);o=await e,n.drop()}catch(t){o=void 0,await d(e);continue}if(!o.ok||o.status>=300||o.status<200)o=void 0,await d(e);else{if(await o.clone().text())return await r.put(t,o.clone()),o;o=void 0,await d(e)}}return o||n}async function m(){let t=await caches.open("cards"),e=(await t.keys()).filter((t=>t.url.includes("pseudo-api/card-list/")));if(!e.length)return;let n={};const s=e.map((async e=>{const[s,a]=e.url.match(l);n[a]=await t.match(e).then((t=>t.json()))}));await Promise.all(s);const a=Object.keys(n).map((async e=>{const s=n[e].reduce((async(n,s)=>{const a=i+s;await n;let r=await c(0,a).then((t=>t.json()));if(r.dataVersion&&r.dataVersion>1)return;r.type=e,r.dataVersion=2,r.rarity&&(r.rarity.includes("gemless")||r.rarity.includes("none"))&&(r.rarity="");const o=new Response(JSON.stringify(r),{"Content-Type":"application/json",status:200});return t.put(a,o)}),Promise.resolve());return await s,t.delete("pseudo-api/card-list/"+e)}));await Promise.all(a)}async function y(){console.log("migrating to multi subtype");let t=await caches.open("cards"),e=(await t.keys()).filter((t=>t.url.includes(i))).map((t=>{let[e,n]=t.url.match(l);return n})).map((async t=>{let e=await c(0,i+t).then((t=>t.json()));return e.id=t,e})),n=(await Promise.all(e)).map((e=>{if(!Object.prototype.hasOwnProperty.call(e,"clan"))return;if(Array.isArray(e.clan))return;e.clan?e.clan=[e.clan]:e.clan=[];let n=new Response(JSON.stringify(e),{"Content-Type":"application/json",status:200});return t.put(i+e.id,n.clone())}));return Promise.all(n)}