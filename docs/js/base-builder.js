!function(){let e=App.baseBuilderController={};e.card={},e.clearCard=e.createPreview=e.saveCard=e.deleteCard=function(){console.warn("oops, you called a stub... probs should fix")};e.decorateText=function(e){let t=e;return Object.keys(cardOptionsData.icons).forEach(e=>{let r=`<${e}/>`;t=t.split(r).join(`<div xmlns="http://www.w3.org/1999/xhtml" style="height: 1.2em; width: 1.2em; display:inline-block; background-repeat: no-repeat; background-size: contain; background-image: url('${iconCache[e]}');vertical-align: middle;"></div>`)}),t=this.card.blueWords.reduce((e,t)=>t?e.split(t).join(`<span style="color: #49a0f8" xmlns="http://www.w3.org/1999/xhtml">${t}</span>`):e,t),t=this.card.orangeWords.reduce((e,t)=>t?e.split(t).join(`<span style="color: #fad65a" xmlns="http://www.w3.org/1999/xhtml">${t}</span>`):e,t),t=t.split("\n").map(e=>`<div>${e}</div>`).join(""),t},e.wrapText=function(e,t,r={}){let n=d3plus.textwrap().container(d3.select(e)).resize(!!t);r.align?n.align(r.align):n.align("middle"),r.valign&&n.valign(r.valign),r.shape&&n.shape(r.shape),r.size&&n.size(r.size),n.draw()},e.effectResize=async function(e,t="effectFontSize"){let r=this,n=e.offsetHeight;for(;e.scrollHeight>n&&r.card[t]>24;)r.card[t]--,await proxymity.on.renderend},e.exportCard=async function(){let e=this,t=Array.from(e.cardInstance.querySelectorAll("image")).map(e=>e.href.baseVal&&getBase64FromImageUrl(e.href.baseVal).then(t=>{e.removeAttribute("href"),e.removeAttribute(":xlinkhref"),e.setAttribute("xlink:href",t)}));e.exporting=!0,t.push(proxymity.on.renderend),await Promise.all(t),e.cardInstance.querySelectorAll("foreignObject *").forEach(e=>e.removeAttribute("xmlns"));let r=await svgAsPngUri(e.cardInstance,{width:680,height:1024,scale:1/(window.devicePixelRatio||1)});e.exporting=!1,function(e){const t=/data:([^;]+);base64,/.exec(e)[1],r=atob(e.substr(`data:${t};base64,`.length)),n=[];for(let e=0;e<r.length;e+=1024){const t=r.slice(e,e+1024),a=new Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);const i=new Uint8Array(a);n.push(i)}const a=new Blob(n,{type:t}),i=URL.createObjectURL(a);window.open(i,"_blank")}(r)};e.focusFactory=function(e,t,r){let n=this;return function(){return iconCache.promise.then(()=>{n.cardOptionsController.app.mbShowConfigs=!1,App.currentView!==e&&(App.currentView=e,n.clearCard(),window.scroll(0,0),history.pushState({focus:t},r))})}}}();