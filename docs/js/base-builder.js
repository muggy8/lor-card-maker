!function(){let e=App.baseBuilderController={};e.clearCard=e.createPreview=e.saveCard=e.deleteCard=function(){console.warn("oops, you called a stub... probs should fix")};e.decorateText=function(e){let t=e;return Object.keys(cardOptionsData.icons).forEach(e=>{let r=`<${e}/>`;t=t.split(r).join(`<div xmlns="http://www.w3.org/1999/xhtml" style="height: 1.2em; width: 1.2em; display:inline-block; background-repeat: no-repeat; background-size: contain; background-image: url('${iconCache[e]}');vertical-align: middle;"></div>`)}),t=this.card.blueWords.reduce((e,t)=>t?e.split(t).join(`<span style="color: #49a0f8" xmlns="http://www.w3.org/1999/xhtml">${t}</span>`):e,t),t=this.card.orangeWords.reduce((e,t)=>t?e.split(t).join(`<span style="color: #fad65a" xmlns="http://www.w3.org/1999/xhtml">${t}</span>`):e,t),t=t.split("\n").map(e=>`<div>${e}</div>`).join(""),t},e.wrapText=function(e,t,r={}){let a=d3plus.textwrap().container(d3.select(e)).resize(!!t);r.align?a.align(r.align):a.align("middle"),r.valign&&a.valign(r.valign),r.shape&&a.shape(r.shape),r.size&&a.size(r.size),a.draw()},e.effectResize=async function(e,t="effectFontSize"){let r=this,a=e.offsetHeight;for(;e.scrollHeight>a&&r.card[t]>24;)r.card[t]--,await proxymity.on.renderend},e.exportCard=async function(e){let t=this;e=e||t.cardInstance;let r=Array.from(e.querySelectorAll("image")).map(e=>e.href.baseVal&&!function(e){if(""===e||""===e.trim())return!1;try{return btoa(atob(e))==e}catch(e){return!1}}(e.href.baseVal)?imageToBase64(e.href.baseVal).then(t=>{console.log(e.href.baseVal),e.removeAttribute("href"),e.removeAttribute(":xlinkhref"),e.setAttribute("xlink:href",t)}):Promise.resolve());t.exporting=!0,r.push(proxymity.on.renderend);try{await Promise.all(r)}catch(e){console.warn(e)}e.querySelectorAll("foreignObject *").forEach(e=>e.removeAttribute("xmlns"));let a=await svgAsPngUri(e,{width:e.viewBox.baseVal.width,height:e.viewBox.baseVal.height,scale:1/(window.devicePixelRatio||1)});t.exporting=!1,function(e){const t=/data:([^;]+);base64,/.exec(e)[1],r=atob(e.substr(`data:${t};base64,`.length)),a=[];for(let e=0;e<r.length;e+=1024){const t=r.slice(e,e+1024),n=new Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);const i=new Uint8Array(n);a.push(i)}const n=new Blob(a,{type:t}),i=URL.createObjectURL(n);window.open(i,"_blank")}(a)};e.focusFactory=function(e,t,r){let a=this;return function(){return iconCache.promise.then(()=>{a.cardOptionsController.app.mbShowConfigs=!1,App.currentView!==e&&(App.currentView=e,a.clearCard(),window.scroll(0,0),history.pushState({focus:t},r))})}}}();