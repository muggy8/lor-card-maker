<html>
	<head>
		<script defer type="module">
			if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('./service-worker.js', {
					scope: document.location.pathname,
				})
					.then(async function(registration) {
						console.log('Registration successful:', registration)

						// check for worker update because we dont want to load anything until the worker is known to be the latest worker.
						const updatedRegistration = await registration.update()
						
						// if the updatedRegistration has something in the installing prop, we know that we found an update so we will want to wait for it to finish it's install and activate process before we continue.
						if (updatedRegistration.installing){
							return await new Promise((accept)=>{
								updatedRegistration.installing.addEventListener("statechange", ev=>{
									console.log(ev)
									if (ev.target.state === "activated"){
										accept(updatedRegistration)
									}
								})
							})
						}
						return updatedRegistration
					})
					.then(function(){
						// at this point, we know that the service worker has been registered and is active. that means we can use ESM to import our main app and we'll let the service worker figure out how to fulfill the import requests 
						import("/app/index.js")
					})
					.catch(function(error) {
						console.log('Service worker registration failed, error:', error);
					});
			}
		</script>
	</head>
	<body>
		<section id="app"></section>
	</body>
</html>
